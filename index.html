<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASSIFIED - Hoi An Social Discovery</title>
    
    <!-- Firebase SDKs - Using newer, more reliable version -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyB-zTm6JB4EkD_7Q9056K4UGbIPyHQL4S4",
            authDomain: "hoi-an-social-app.firebaseapp.com",
            databaseURL: "https://hoi-an-social-app-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hoi-an-social-app",
            storageBucket: "hoi-an-social-app.firebasestorage.app",
            messagingSenderId: "302219568692",
            appId: "1:302219568692:web:3edf7128342b74b1e0cc61",
            measurementId: "G-WX23VDV53B"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Initialize services and make them globally available
        window.auth = firebase.auth();
        window.db = firebase.firestore();
        window.storage = firebase.storage();
        
        // Mark Firebase as ready
        window.CLASSIFIED = window.CLASSIFIED || {};
        window.CLASSIFIED.state = window.CLASSIFIED.state || {};
        window.CLASSIFIED.state.firebaseReady = true;
        
        console.log('🔥 Firebase initialized successfully!');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }
        .app-container {
            max-width: 430px;
            margin: 0 auto;
            background: #1a1a1a;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .back-btn {
            background: none;
            border: none;
            color: #FFD700;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        .back-btn:hover {
            background: rgba(255,215,0,0.1);
        }
        .header-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }
        .settings-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        .match-badge {
            background: rgba(0,212,255,0.2);
            color: #00D4FF;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid rgba(0,212,255,0.3);
            font-weight: 600;
        }
        /* Main Screen Container */
        .main-screens {
            position: relative;
            min-height: calc(100vh - 140px);
            padding-bottom: 100px;
            display: none; /* Hidden until authenticated */
        }
        .main-screens.authenticated {
            display: block;
        }
        .screen {
            display: none;
            animation: slideIn 0.3s ease;
            width: 100%;
            max-width: 430px;
            margin: 0 auto;
        }
        .screen.active {
            display: block;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        /* Social Tabs */
        .social-tabs {
            display: flex;
            background: rgba(255,255,255,0.05);
            margin: 20px;
            border-radius: 25px;
            padding: 4px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .social-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }
        .social-tab.active {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            color: white;
            transform: scale(1.02);
        }
        .social-content {
            display: none;
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        .social-content.active {
            display: block;
        }
        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 10px;
            margin: 20px;
        }
        .search-input {
            flex: 1;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            font-size: 14px;
        }
        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .search-input:focus {
            outline: none;
            border-color: #00D4FF;
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        .filter-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .filter-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        /* Stories Section */
        .stories-section {
            padding: 20px;
            width: 100%;
            max-width: 430px;
            margin: 0 auto;
        }
        .stories-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        .stories-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .stories-scroll::-webkit-scrollbar {
            display: none;
        }
        .story-item {
            flex-shrink: 0;
            width: 120px;
            height: 180px;
            border-radius: 12px;
            background-size: cover;
            background-position: center;
            position: relative;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .story-item:hover {
            transform: scale(1.05);
        }
        .story-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 12px;
            border-radius: 0 0 10px 10px;
        }
        .story-title {
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }
        .story-subtitle {
            font-size: 10px;
            opacity: 0.8;
        }
        /* Feed Container */
        .feed-container {
            padding: 0 20px 20px 20px;
            width: 100%;
            max-width: 430px;
            margin: 0 auto;
        }
        .feed-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .feed-header h3 {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        /* Business Cards */
        .business-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .business-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: rgba(0,212,255,0.3);
        }
        .business-header {
            padding: 15px;
            display: flex;
            align-items: center;
        }
        .business-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .business-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        .business-info p {
            font-size: 12px;
            opacity: 0.7;
        }
        .business-image {
            width: 100%;
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .business-content {
            padding: 15px;
        }
        .business-description {
            font-size: 14px;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 12px;
        }
        .business-promo {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
        }
        .promo-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .promo-details {
            font-size: 12px;
            opacity: 0.9;
        }
        /* Filter Options */
        .filter-options {
            display: flex;
            gap: 12px;
            padding: 0 20px 20px 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .filter-options::-webkit-scrollbar {
            display: none;
        }
        .filter-chip {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 10px 18px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .filter-chip.active {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border-color: #00D4FF;
            transform: scale(1.02);
        }
        .filter-chip:hover:not(.active) {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.3);
        }
        /* User Feed Styles */
        .user-feed-container {
            height: calc(100vh - 280px);
            overflow-y: auto;
            padding: 0 20px 20px 20px;
        }
        .user-feed-item {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            animation: fadeInUp 0.3s ease;
            position: relative;
            cursor: pointer;
        }
        .user-feed-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            border-color: rgba(0,212,255,0.3);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-status-badges {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        .status-badge {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .status-online {
            color: #4CAF50;
            border-color: rgba(76,175,80,0.3);
        }
        .status-distance {
            color: #00D4FF;
            border-color: rgba(0,212,255,0.3);
        }
        .status-match {
            color: #FFD700;
            border-color: rgba(255,215,0,0.3);
        }
        .user-image {
            width: 100%;
            height: 400px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .user-image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 30px 20px 20px;
        }
        .user-info {
            padding: 20px;
        }
        .user-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: white;
        }
        .user-bio {
            font-size: 15px;
            opacity: 0.9;
            margin-bottom: 18px;
            line-height: 1.5;
        }
        .user-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
        }
        .interest-tag {
            background: rgba(0, 212, 255, 0.2);
            color: #00D4FF;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-weight: 500;
        }
        .user-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            padding: 0 5px 5px 5px;
        }
        .action-btn {
            flex: 1;
            height: 50px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .pass-btn { 
            background: rgba(255,107,107,0.9);
            color: white;
        }
        .pass-btn:hover {
            background: #FF6B6B;
        }
        .chat-btn { 
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            color: white;
        }
        .chat-btn:hover {
            background: linear-gradient(135deg, #0099CC, #0066AA);
        }
        .super-btn { 
            background: linear-gradient(135deg, #FFD93D, #FFC107);
            color: white;
        }
        .super-btn:hover {
            background: linear-gradient(135deg, #FFC107, #FF9800);
        }
        /* Messaging Styles */
        .messaging-container {
            min-height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            background: #1a1a1a;
        }
        .matches-section {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: #1a1a1a;
        }
        .matches-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .matches-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
        }
        .matches-scroll::-webkit-scrollbar {
            display: none;
        }
        .match-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            border: 2px solid #00D4FF;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        .match-avatar:hover {
            transform: scale(1.05);
        }
        .chat-list {
            flex: 1;
            overflow-y: auto;
            background: #1a1a1a;
        }
        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background 0.3s ease;
        }
        .chat-item:hover {
            background: rgba(255,255,255,0.05);
        }
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
        }
        .chat-info {
            flex: 1;
        }
        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .chat-message {
            font-size: 14px;
            opacity: 0.7;
        }
        .chat-time {
            font-size: 12px;
            opacity: 0.5;
        }
        /* Overlay Screens */
        .overlay-screen {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            height: 100vh;
            background: #1a1a1a;
            z-index: 200;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        .overlay-screen.show {
            display: flex;
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); }
            to { transform: translateX(-50%) translateY(0); }
        }
        /* Profile Editor Styles - SHARED */
        .profile-editor {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .profile-section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #00D4FF;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        .form-input {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            font-size: 14px;
        }
        .form-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .form-input:focus {
            outline: none;
            border-color: #00D4FF;
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        .choice-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .choice-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        .choice-btn.active {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border-color: #00D4FF;
        }
        .choice-btn:hover:not(.active) {
            background: rgba(255,255,255,0.2);
        }
        .photo-upload-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px dashed rgba(255,255,255,0.2);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .photo-upload-section:hover {
            border-color: #00D4FF;
            background: rgba(0,212,255,0.1);
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .photo-slot {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px dashed rgba(255,255,255,0.2);
        }
        .photo-slot:hover {
            border-color: #00D4FF;
            background: rgba(0,212,255,0.1);
        }
        .photo-slot.filled {
            background-size: cover;
            background-position: center;
            border: 2px solid #00D4FF;
        }
        .star-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #FFD700;
            font-size: 20px;
        }
        .interests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        .interest-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .interest-btn.active {
            background: rgba(0, 212, 255, 0.2);
            color: #00D4FF;
            border-color: rgba(0, 212, 255, 0.3);
        }
        .save-profile-btn {
            width: 100%;
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border: none;
            border-radius: 25px;
            padding: 15px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .save-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,212,255,0.3);
        }
        /* Business-specific styles */
        .business-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }
        .business-hours-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .time-input {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            font-size: 14px;
        }
        /* Profile View Styles */
        .profile-hero {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .profile-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 30px 20px 20px;
        }
        .profile-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .profile-type {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        .profile-rating {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stars {
            color: #FFD700;
            font-size: 16px;
        }
        .profile-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .profile-description {
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        .profile-details {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .detail-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .detail-label {
            font-weight: 600;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .detail-value {
            color: #00D4FF;
            font-weight: 500;
        }
        .current-promo {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        .promo-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: rgba(0,0,0,0.9);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .action-button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .action-button:hover {
            transform: translateY(-2px);
        }
        .primary-btn {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            color: white;
        }
        .secondary-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        /* Chat Styles */
        .chat-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin: 0 15px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .chat-header-avatar:hover {
            transform: scale(1.05);
        }
        .chat-header-info {
            flex: 1;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }
        .chat-header-info:hover {
            background: rgba(255,255,255,0.1);
        }
        .chat-header-info:hover .chat-header-name {
            color: #00D4FF;
        }
        .chat-header-name {
            font-weight: 600;
            margin-bottom: 2px;
            transition: color 0.2s ease;
        }
        .chat-status {
            font-size: 12px;
            opacity: 0.7;
        }
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
            animation: messageAppear 0.3s ease;
        }
        .message.sent {
            justify-content: flex-end;
        }
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        .message.received .message-bubble {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .message.sent .message-bubble {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            color: white;
        }
        .promo-message-card {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            max-width: 250px;
        }
        .chat-input {
            display: flex;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .chat-input input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            margin-right: 10px;
        }
        .chat-input input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .chat-input input:focus {
            outline: none;
            border-color: #00D4FF;
        }
        .send-btn {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: transform 0.2s ease;
        }
        .send-btn:hover {
            transform: scale(1.05);
        }
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: none; /* Hidden until authenticated */
            justify-content: space-around;
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 150;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 70px;
        }
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        .nav-item.active {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            transform: translateY(-2px);
        }
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        .nav-label {
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        /* Match Popup */
        .match-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        .match-popup.show {
            display: flex;
        }
        .match-content {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 300px;
            animation: popIn 0.3s ease;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .match-text {
            font-size: 32px;
            font-weight: 700;
            color: #00D4FF;
            margin-bottom: 20px;
        }
        .match-btn {
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        .match-btn:hover {
            transform: scale(1.05);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Responsive Design */
        @media (max-width: 430px) {
            .app-container {
                max-width: 100vw;
            }
            .user-feed-item {
                margin: 0 10px 20px 10px;
            }
            .bottom-nav {
                max-width: 100vw;
            }
            .overlay-screen {
                max-width: 100vw;
            }
        }
        /* Auth Screens Styles */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            z-index: 300;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        .auth-screen.show {
            display: flex;
        }
        .auth-header {
            text-align: center;
            padding: 60px 20px 40px;
        }
        .auth-logo {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, #FFD700, #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .auth-tagline {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 40px;
        }
        .auth-form {
            padding: 0 30px;
            flex: 1;
        }
        .auth-input {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .auth-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .auth-input:focus {
            outline: none;
            border-color: #00D4FF;
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        .auth-btn {
            width: 100%;
            background: linear-gradient(135deg, #00D4FF, #0099CC);
            border: none;
            border-radius: 25px;
            padding: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,212,255,0.3);
        }
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .google-btn {
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .google-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .auth-divider {
            text-align: center;
            margin: 30px 0;
            position: relative;
            color: rgba(255,255,255,0.5);
        }
        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255,255,255,0.2);
        }
        .auth-divider span {
            background: #1a1a1a;
            padding: 0 15px;
        }
        .auth-switch {
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .auth-switch a {
            color: #00D4FF;
            text-decoration: none;
            font-weight: 600;
        }
        .auth-switch a:hover {
            text-decoration: underline;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 400;
        }
        .loading-overlay.show {
            display: flex;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left: 4px solid #00D4FF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Business Navigation - Hidden for regular users */
        .business-nav {
            display: none;
        }
        .business-nav.show {
            display: flex;
        }
        
        /* User Navigation - Hidden for business users */
        .user-nav.hide {
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Screens Container -->
        <div class="main-screens">
            <!-- Restaurant Feed Screen -->
            <div id="restaurantScreen" class="screen active">
                <div class="header">
                    <button class="back-btn">←</button>
                    <div class="header-title">Hungry?</div>
                    <button class="settings-btn" onclick="CLASSIFIED.openSettings()">⚙️</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Find Restaurant...">
                    <button class="filter-btn">🔽 Filter by preferences</button>
                </div>
                <div class="stories-section">
                    <div class="stories-title">DAILY STORIES</div>
                    <div class="stories-scroll" id="restaurantStories">
                        <!-- Stories populated by JavaScript -->
                    </div>
                </div>
                <div class="feed-container">
                    <div class="feed-header">
                        <h3>FEATURED</h3>
                    </div>
                    <div id="restaurantFeed">
                        <!-- Restaurant cards populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Social Screen - Hide for business users -->
            <div id="socialScreen" class="screen user-only">
                <div class="header">
                    <button class="back-btn">←</button>
                    <div class="header-title">Feeling Adventurous?!</div>
                    <div class="match-badge">83% Match</div>
                </div>
                <div class="social-tabs">
                    <div class="social-tab active" data-tab="userFeed">👥 Browse People</div>
                    <div class="social-tab" data-tab="messaging">💬 Messaging</div>
                </div>
                <!-- User Feed Content -->
                <div id="userFeedContent" class="social-content active">
                    <!-- Filter Options -->
                    <div class="filter-options">
                        <div class="filter-chip active" data-filter="all">All</div>
                        <div class="filter-chip" data-filter="online">🟢 Online Now</div>
                        <div class="filter-chip" data-filter="nearby">📍 Nearby</div>
                        <div class="filter-chip" data-filter="nomads">💻 Digital Nomads</div>
                    </div>
                    <div class="user-feed-container" id="userFeedContainer">
                        <!-- User feed items populated by JavaScript -->
                    </div>
                </div>
                <!-- Messaging Content -->
                <div id="messagingContent" class="social-content">
                    <div class="messaging-container">
                        <div class="matches-section">
                            <div class="matches-title">New Matches</div>
                            <div class="matches-scroll" id="matchesScroll">
                                <!-- Match avatars populated by JavaScript -->
                            </div>
                        </div>
                        <div class="chat-list" id="chatList">
                            <!-- Chat items populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Activity Feed Screen -->
            <div id="activityScreen" class="screen">
                <div class="header">
                    <button class="back-btn">←</button>
                    <div class="header-title">Feeling Adventurous?!</div>
                    <button class="settings-btn" onclick="CLASSIFIED.openSettings()">⚙️</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Find Activity...">
                    <button class="filter-btn">🔽 Filter by preferences</button>
                </div>
                <div class="stories-section">
                    <div class="stories-title">DAILY STORIES</div>
                    <div class="stories-scroll" id="activityStories">
                        <!-- Stories populated by JavaScript -->
                    </div>
                </div>
                <div class="feed-container">
                    <div class="feed-header">
                        <h3>FEATURED</h3>
                    </div>
                    <div id="activityFeed">
                        <!-- Activity cards populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Business Dashboard Screen - Only for business users -->
            <div id="businessDashboard" class="screen business-only" style="display: none;">
                <div class="header">
                    <button class="back-btn">←</button>
                    <div class="header-title">Business Dashboard</div>
                    <button class="settings-btn" onclick="CLASSIFIED.openSettings()">⚙️</button>
                </div>
                <div class="feed-container">
                    <div class="feed-header">
                        <h3>YOUR BUSINESS OVERVIEW</h3>
                    </div>
                    <div style="text-align: center; padding: 40px; opacity: 0.8;">
                        <div style="font-size: 48px; margin-bottom: 20px;">🏪</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">Welcome to your Business Dashboard!</div>
                        <div style="font-size: 14px; margin-bottom: 20px;">Manage your business profile and connect with customers.</div>
                        <button onclick="CLASSIFIED.openBusinessProfileEditor()" style="background: linear-gradient(135deg, #00D4FF, #0099CC); border: none; color: white; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 600;">Complete Your Profile</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Profile Editor Overlay -->
        <div id="profileEditor" class="overlay-screen">
            <div class="header">
                <button class="back-btn" onclick="CLASSIFIED.closeProfileEditor()">←</button>
                <div class="header-title">Edit Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.viewMyProfile()">👤</button>
            </div>
            <div class="profile-editor">
                <!-- Profile Photos Section -->
                <div class="profile-section">
                    <div class="section-title">Profile Photos</div>
                    <div class="photo-upload-section" onclick="CLASSIFIED.uploadPhoto()">
                        <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">📷</div>
                        <div style="font-weight: 600;">Add Your Best Photos</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Tap to add photos</div>
                    </div>
                    <div class="photo-grid" id="photoGrid">
                        <div class="photo-slot" onclick="CLASSIFIED.uploadPhoto(0)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadPhoto(1)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadPhoto(2)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadPhoto(3)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                    </div>
                </div>
                <!-- About Me Section -->
                <div class="profile-section">
                    <div class="section-title">About Me</div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-input form-textarea" id="profileBio" placeholder="Write about yourself or something you're up to..."></textarea>
                    </div>
                </div>
                <!-- Basic Info Section -->
                <div class="profile-section">
                    <div class="section-title">Basic Info</div>
                    
                    <div class="form-group">
                        <label class="form-label">Birthday</label>
                        <input type="date" class="form-input" id="profileBirthday">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Zodiac Sign</label>
                        <div class="choice-group">
                            <div class="choice-btn" data-choice="zodiac" data-value="Aries">♈ Aries</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Taurus">♉ Taurus</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Gemini">♊ Gemini</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Cancer">♋ Cancer</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Leo">♌ Leo</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Virgo">♍ Virgo</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Libra">♎ Libra</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Scorpio">♏ Scorpio</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Sagittarius">♐ Sagittarius</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Capricorn">♑ Capricorn</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Aquarius">♒ Aquarius</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Pisces">♓ Pisces</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Height</label>
                        <div class="choice-group">
                            <input type="text" class="form-input" id="profileHeight" placeholder="5'7&quot; or 170cm">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Career</label>
                        <div class="choice-group">
                            <div class="choice-btn" data-choice="career" data-value="Student">Student</div>
                            <div class="choice-btn" data-choice="career" data-value="Digital Nomad">Digital Nomad</div>
                            <div class="choice-btn" data-choice="career" data-value="Teacher">Teacher</div>
                            <div class="choice-btn" data-choice="career" data-value="Nurse">Nurse</div>
                            <div class="choice-btn" data-choice="career" data-value="Engineer">Engineer</div>
                            <div class="choice-btn" data-choice="career" data-value="Artist">Artist</div>
                            <div class="choice-btn" data-choice="career" data-value="Business">Business</div>
                            <div class="choice-btn" data-choice="career" data-value="Other">Other</div>
                        </div>
                    </div>
                </div>
                <!-- Interests Section -->
                <div class="profile-section">
                    <div class="section-title">What Am I Like</div>
                    <div class="interests-grid">
                        <div class="interest-btn" data-interest="Adventure">Adventure</div>
                        <div class="interest-btn" data-interest="Reading">Reading</div>
                        <div class="interest-btn" data-interest="Sports">Sports</div>
                        <div class="interest-btn" data-interest="Music">Music</div>
                        <div class="interest-btn" data-interest="Travel">Travel</div>
                        <div class="interest-btn" data-interest="Food">Food</div>
                        <div class="interest-btn" data-interest="Art">Art</div>
                        <div class="interest-btn" data-interest="Fitness">Fitness</div>
                        <div class="interest-btn" data-interest="Photography">Photography</div>
                        <div class="interest-btn" data-interest="Cooking">Cooking</div>
                        <div class="interest-btn" data-interest="Dancing">Dancing</div>
                        <div class="interest-btn" data-interest="Gaming">Gaming</div>
                    </div>
                </div>
                <!-- Preferences Section -->
                <div class="profile-section">
                    <div class="section-title">What Do I Like Most</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="priority" data-value="Travel">Travel</div>
                        <div class="choice-btn" data-choice="priority" data-value="Friends">Friends</div>
                        <div class="choice-btn" data-choice="priority" data-value="Family">Family</div>
                        <div class="choice-btn" data-choice="priority" data-value="Career">Career</div>
                    </div>
                </div>
                <!-- Relationship Section -->
                <div class="profile-section">
                    <div class="section-title">Relationship Status</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="relationship" data-value="Single">Single</div>
                        <div class="choice-btn" data-choice="relationship" data-value="In a Relationship">In a Relationship</div>
                        <div class="choice-btn" data-choice="relationship" data-value="Common Law w. Children">Common Law w. Children</div>
                        <div class="choice-btn" data-choice="relationship" data-value="It's Complicated">It's Complicated</div>
                    </div>
                </div>
                <!-- Looking For Section -->
                <div class="profile-section">
                    <div class="section-title">What Am I Looking For</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="lookingFor" data-value="Friends">Friends</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Dating">Dating</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Networking">Networking</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Adventure Buddies">Adventure Buddies</div>
                    </div>
                </div>
                <!-- Marriage Thoughts Section -->
                <div class="profile-section">
                    <div class="section-title">Thoughts about Marriage</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="marriage" data-value="Wants One Day">💍 Wants One Day</div>
                        <div class="choice-btn" data-choice="marriage" data-value="Not Sure">🤷 Not Sure</div>
                        <div class="choice-btn" data-choice="marriage" data-value="Not Interested">❌ Not Interested</div>
                    </div>
                </div>
                <button class="save-profile-btn" onclick="CLASSIFIED.saveUserProfile()">Save Profile</button>
            </div>
        </div>

        <!-- Business Profile Editor Overlay -->
        <div id="businessProfileEditor" class="overlay-screen">
            <div class="header">
                <button class="back-btn" onclick="CLASSIFIED.closeBusinessProfileEditor()">←</button>
                <div class="header-title">Edit Business Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.viewMyBusinessProfile()">🏪</button>
            </div>
            <div class="profile-editor">
                <!-- Business Photos Section -->
                <div class="profile-section">
                    <div class="section-title">Business Photos</div>
                    <div class="photo-upload-section" onclick="CLASSIFIED.uploadBusinessPhoto()">
                        <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">🏪</div>
                        <div style="font-weight: 600;">Add Your Business Photos</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Showcase your venue and atmosphere</div>
                    </div>
                    <div class="photo-grid" id="businessPhotoGrid">
                        <div class="photo-slot" onclick="CLASSIFIED.uploadBusinessPhoto(0)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadBusinessPhoto(1)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadBusinessPhoto(2)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                        <div class="photo-slot" onclick="CLASSIFIED.uploadBusinessPhoto(3)">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                        </div>
                    </div>
                </div>

                <!-- Business Info Section -->
                <div class="profile-section">
                    <div class="section-title">Business Information</div>
                    <div class="form-group">
                        <label class="form-label">Business Name</label>
                        <input type="text" class="form-input" id="businessName" placeholder="Your business name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input form-textarea" id="businessDescription" placeholder="Describe your business, atmosphere, and what makes you special..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-input" id="businessAddress" placeholder="Full address in Hoi An">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="businessPhone" placeholder="+84 XXX XXX XXX">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Website/Social Media</label>
                        <input type="url" class="form-input" id="businessWebsite" placeholder="https://your-website.com or @instagram">
                    </div>
                </div>

                <!-- Business Category Section -->
                <div class="profile-section">
                    <div class="section-title">Business Category</div>
                    <div class="business-category-grid">
                        <div class="choice-btn" data-choice="businessCategory" data-value="Restaurant">🍽️ Restaurant</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Bar">🍺 Bar</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Cafe">☕ Cafe</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Hotel">🏨 Hotel</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Activity">🎯 Activity</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Tour">🚤 Tour</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Shop">🛍️ Shop</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Spa">🧘 Spa</div>
                        <div class="choice-btn" data-choice="businessCategory" data-value="Other">🏪 Other</div>
                    </div>
                </div>

                <!-- Business Hours Section -->
                <div class="profile-section">
                    <div class="section-title">Business Hours</div>
                    <div class="form-group">
                        <label class="form-label">Monday - Friday</label>
                        <div class="business-hours-grid">
                            <input type="time" class="time-input" id="weekdayOpen" placeholder="Open">
                            <input type="time" class="time-input" id="weekdayClose" placeholder="Close">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Saturday - Sunday</label>
                        <div class="business-hours-grid">
                            <input type="time" class="time-input" id="weekendOpen" placeholder="Open">
                            <input type="time" class="time-input" id="weekendClose" placeholder="Close">
                        </div>
                    </div>
                </div>

                <!-- Price Range Section -->
                <div class="profile-section">
                    <div class="section-title">Price Range</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="priceRange" data-value="$">$ Budget</div>
                        <div class="choice-btn" data-choice="priceRange" data-value="$$">$$ Moderate</div>
                        <div class="choice-btn" data-choice="priceRange" data-value="$$$">$$$ High</div>
                        <div class="choice-btn" data-choice="priceRange" data-value="$$$$">$$$$ Premium</div>
                    </div>
                </div>

                <!-- Target Audience Section -->
                <div class="profile-section">
                    <div class="section-title">Target Audience</div>
                    <div class="interests-grid">
                        <div class="interest-btn" data-business-audience="Backpackers">Backpackers</div>
                        <div class="interest-btn" data-business-audience="Digital Nomads">Digital Nomads</div>
                        <div class="interest-btn" data-business-audience="Families">Families</div>
                        <div class="interest-btn" data-business-audience="Couples">Couples</div>
                        <div class="interest-btn" data-business-audience="Groups">Groups</div>
                        <div class="interest-btn" data-business-audience="Solo Travelers">Solo Travelers</div>
                        <div class="interest-btn" data-business-audience="Locals">Locals</div>
                        <div class="interest-btn" data-business-audience="Expats">Expats</div>
                    </div>
                </div>

                <!-- Amenities Section -->
                <div class="profile-section">
                    <div class="section-title">Amenities & Features</div>
                    <div class="interests-grid">
                        <div class="interest-btn" data-business-amenity="WiFi">WiFi</div>
                        <div class="interest-btn" data-business-amenity="Air Conditioning">Air Conditioning</div>
                        <div class="interest-btn" data-business-amenity="Outdoor Seating">Outdoor Seating</div>
                        <div class="interest-btn" data-business-amenity="Live Music">Live Music</div>
                        <div class="interest-btn" data-business-amenity="Pool Table">Pool Table</div>
                        <div class="interest-btn" data-business-amenity="Vegetarian Options">Vegetarian Options</div>
                        <div class="interest-btn" data-business-amenity="Happy Hour">Happy Hour</div>
                        <div class="interest-btn" data-business-amenity="Group Bookings">Group Bookings</div>
                        <div class="interest-btn" data-business-amenity="Takeaway">Takeaway</div>
                        <div class="interest-btn" data-business-amenity="Credit Cards">Credit Cards</div>
                        <div class="interest-btn" data-business-amenity="English Speaking">English Speaking</div>
                        <div class="interest-btn" data-business-amenity="Parking">Parking</div>
                    </div>
                </div>

                <button class="save-profile-btn" onclick="CLASSIFIED.saveBusinessProfile()">Save Business Profile</button>
            </div>
        </div>

        <!-- User Profile View Overlay -->
        <div id="userProfileView" class="overlay-screen">
            <div class="header">
                <button class="back-btn" onclick="CLASSIFIED.closeUserProfile()">←</button>
                <div class="header-title" id="userProfileTitle">Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.startChatWithViewedUser()">💬</button>
            </div>
            <div class="profile-hero" id="userProfileHero">
                <div class="profile-overlay">
                    <div class="profile-name" id="userProfileName">Loading...</div>
                    <div class="profile-type" id="userProfileAge">Loading...</div>
                    <div class="profile-rating">
                        <div class="stars" style="color: #00D4FF;">🔥🔥🔥</div>
                        <span id="userProfileMatch">85% Match</span>
                    </div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-title">About</div>
                    <div class="profile-description" id="userProfileBio">
                        Loading user bio...
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">📍 Distance</div>
                            <div class="detail-value" id="userProfileDistance">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">🟢 Status</div>
                            <div class="detail-value" id="userProfileStatus">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">📊 Category</div>
                            <div class="detail-value" id="userProfileCategory">-</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Interests</div>
                    <div class="user-interests" id="userProfileInterests">
                        <!-- Interests populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.handleUserAction('pass')">✕ Pass</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.handleUserAction('like')">💬 Like</button>
            </div>
        </div>
        
        <!-- My Profile View Overlay -->
        <div id="myProfileView" class="overlay-screen">
            <div class="header">
                <button class="back-btn" onclick="CLASSIFIED.closeMyProfile()">←</button>
                <div class="header-title">My Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.openProfileEditor()">✏️</button>
            </div>
            <div class="profile-hero" id="myProfileHero" style="background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop')">
                <div class="profile-overlay">
                    <div class="profile-name" id="myProfileName">Your Name</div>
                    <div class="profile-type" id="myProfileAge">Age</div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-title">About Me</div>
                    <div class="profile-description" id="myProfileBio">
                        Complete your profile to start connecting with amazing people in Hoi An!
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">🎂 Age</div>
                            <div class="detail-value" id="myProfileAgeDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">📏 Height</div>
                            <div class="detail-value" id="myProfileHeightDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">💼 Career</div>
                            <div class="detail-value" id="myProfileCareerDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">⭐ Zodiac</div>
                            <div class="detail-value" id="myProfileZodiacDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">💝 Looking For</div>
                            <div class="detail-value" id="myProfileLookingForDetail">-</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">My Interests</div>
                    <div class="user-interests" id="myProfileInterests">
                        <!-- Interests populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.shareMyProfile()">Share Profile</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.openProfileEditor()">Edit Profile</button>
            </div>
        </div>

        <!-- My Business Profile View Overlay -->
        <div id="myBusinessProfileView" class="overlay-screen">
            <div class="header">
                <button class="back-btn" onclick="CLASSIFIED.closeMyBusinessProfile()">←</button>
                <div class="header-title">My Business Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.openBusinessProfileEditor()">✏️</button>
            </div>
            <div class="profile-hero" id="myBusinessProfileHero" style="background-image: url('https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop')">
                <div class="profile-overlay">
                    <div class="profile-name" id="myBusinessProfileName">Your Business</div>
                    <div class="profile-type" id="myBusinessProfileCategory">Category</div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-title">About Our Business</div>
                    <div class="profile-description" id="myBusinessProfileDescription">
                        Complete your business profile to start attracting customers in Hoi An!
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Business Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">📍 Address</div>
                            <div class="detail-value" id="myBusinessProfileAddress">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">📞 Phone</div>
                            <div class="detail-value" id="myBusinessProfilePhone">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">🕒 Hours</div>
                            <div class="detail-value" id="myBusinessProfileHours">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">💰 Price Range</div>
                            <div class="detail-value" id="myBusinessProfilePrice">-</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Target Audience</div>
                    <div class="user-interests" id="myBusinessProfileAudience">
                        <!-- Audience populated by JavaScript -->
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Amenities</div>
                    <div class="user-interests" id="myBusinessProfileAmenities">
                        <!-- Amenities populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.shareMyBusinessProfile()">Share Profile</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.openBusinessProfileEditor()">Edit Profile</button>
            </div>
        </div>

        <!-- Business Profile Overlay -->
        <div id="businessProfile" class="overlay-screen">
            <div class="header">
                <button class="back-btn" id="profileBackBtn">←</button>
                <div class="header-title" id="profileHeaderTitle">Business Profile</div>
                <button class="settings-btn">⚙️</button>
            </div>
            <div class="profile-hero" id="profileHero">
                <div class="profile-overlay">
                    <div class="profile-name" id="profileName">Loading...</div>
                    <div class="profile-type" id="profileType">Loading...</div>
                    <div class="profile-rating">
                        <div class="stars">★★★★★</div>
                        <span>4.8 (124 reviews)</span>
                    </div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="current-promo">
                        <div class="promo-badge">🔥 SPECIAL OFFER</div>
                        <div class="promo-title" id="profilePromoTitle">Loading...</div>
                        <div class="promo-details" id="profilePromoDetails">Loading...</div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">About</div>
                    <div class="profile-description" id="profileDescription">
                        A vibrant spot in the heart of Hoi An, perfect for backpackers and travelers.
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">📍 Location</div>
                            <div class="detail-value" id="profileLocation">Hoi An Ancient Town</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">🕒 Hours</div>
                            <div class="detail-value" id="profileHours">5:00 PM - 2:00 AM</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">💰 Price Range</div>
                            <div class="detail-value" id="profilePrice">$ - Moderate</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">📱 Contact</div>
                            <div class="detail-value" id="profileContact">+84 123 456 789</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Popular With</div>
                    <div class="user-interests">
                        <span class="interest-tag">Backpackers</span>
                        <span class="interest-tag">Digital Nomads</span>
                        <span class="interest-tag">Expats</span>
                        <span class="interest-tag">Live Music Lovers</span>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.shareBusinessProfile()">Share</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.getDirections()">Get Directions</button>
            </div>
        </div>
        
        <!-- Individual Chat Overlay -->
        <div id="individualChat" class="overlay-screen">
            <div class="chat-header">
                <button class="back-btn" id="chatBackBtn">←</button>
                <div class="chat-header-avatar" id="chatAvatar" onclick="console.log('👆 Avatar clicked!'); CLASSIFIED.openProfileFromChat();"></div>
                <div class="chat-header-info" onclick="console.log('👆 Name area clicked!'); CLASSIFIED.openProfileFromChat();">
                    <div class="chat-header-name" id="chatName">Jessica</div>
                    <div class="chat-status">Online now</div>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div class="message-bubble">Hey! I saw you're into live music too 🎵</div>
                </div>
                <div class="message sent">
                    <div class="message-bubble">Yes! Love finding new venues. Any recommendations in Hoi An?</div>
                </div>
                <div class="message received">
                    <div class="message-bubble">Actually, I just got this promo for tonight!</div>
                </div>
                <div class="message received">
                    <div class="promo-message-card">
                        <div class="promo-title">🍷 Date Night Special</div>
                        <div class="promo-details">2-for-1 Cocktails + Free Appetizer<br>Tonight 6-9pm<br>Banh Mi Queen</div>
                    </div>
                </div>
                <div class="message sent">
                    <div class="message-bubble">Perfect! Want to check it out together? 😊</div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type a message..." id="messageInput">
                <button class="send-btn" id="sendBtn">➤</button>
            </div>
        </div>
        
        <!-- Match Popup -->
        <div id="matchPopup" class="match-popup">
            <div class="match-content">
                <div class="match-text">IT'S A MATCH! 🎉</div>
                <p>You and Jessica both liked each other</p>
                <button class="match-btn" id="startChatBtn">Start Chatting</button>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        
        <!-- Login Screen -->
        <div id="loginScreen" class="auth-screen show">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Discover Hoi An's Hidden Gems</div>
            </div>
            <div class="auth-form">
                <input type="email" class="auth-input" id="loginEmail" placeholder="Email address">
                <input type="password" class="auth-input" id="loginPassword" placeholder="Password">
                <button class="auth-btn" onclick="CLASSIFIED.loginWithEmail()">Sign In</button>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button class="auth-btn google-btn" onclick="CLASSIFIED.loginWithGoogle()">
                    <span>🌟</span>
                    Continue with Google
                </button>
            </div>
            <div class="auth-switch">
                Don't have an account? <a href="#" onclick="CLASSIFIED.showRegister()">Sign up</a>
            </div>
        </div>
        
        <!-- Registration Screen -->
        <div id="registerScreen" class="auth-screen">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Join the Hoi An Community</div>
            </div>
            <div class="auth-form">
                <input type="text" class="auth-input" id="registerName" placeholder="Your name">
                <input type="email" class="auth-input" id="registerEmail" placeholder="Email address">
                <input type="password" class="auth-input" id="registerPassword" placeholder="Create password">
                <input type="password" class="auth-input" id="registerConfirmPassword" placeholder="Confirm password">
                
                <!-- Account Type Selection -->
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600;">Account Type:</label>
                    <div style="display: flex; gap: 10px;">
                        <label style="flex: 1; display: flex; align-items: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="radio" name="accountType" value="user" checked style="margin-right: 8px;">
                            <span>👤 Personal</span>
                        </label>
                        <label style="flex: 1; display: flex; align-items: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="radio" name="accountType" value="business" style="margin-right: 8px;">
                            <span>🏪 Business</span>
                        </label>
                    </div>
                </div>

                <button class="auth-btn" onclick="CLASSIFIED.registerWithEmail()">Create Account</button>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button class="auth-btn google-btn" onclick="CLASSIFIED.loginWithGoogle()">
                    <span>🌟</span>
                    Continue with Google
                </button>
            </div>
            <div class="auth-switch">
                Already have an account? <a href="#" onclick="CLASSIFIED.showLogin()">Sign in</a>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav user-nav">
            <div class="nav-item active" data-screen="restaurant">
                <div class="nav-icon">🏃</div>
                <div class="nav-label">Your Event</div>
            </div>
            <div class="nav-item" data-screen="social">
                <div class="nav-icon">🎀</div>
                <div class="nav-label">Your Social</div>
            </div>
            <div class="nav-item" data-screen="activity">
                <div class="nav-icon">📦</div>
                <div class="nav-label">Your Activity</div>
            </div>
        </div>

        <!-- Business Bottom Navigation -->
        <div class="bottom-nav business-nav">
            <div class="nav-item active" data-screen="restaurant">
                <div class="nav-icon">🍽️</div>
                <div class="nav-label">Restaurants</div>
            </div>
            <div class="nav-item" data-screen="businessDashboard">
                <div class="nav-icon">🏪</div>
                <div class="nav-label">Dashboard</div>
            </div>
            <div class="nav-item" data-screen="activity">
                <div class="nav-icon">🎯</div>
                <div class="nav-label">Activities</div>
            </div>
        </div>
    </div>
    
    <script>
        // 🎯 CLASSIFIED v6.0 - Ultimate Hoi An Social App with Business/User Separation
        const CLASSIFIED = {
            // App State Management
            state: {
                currentScreen: 'restaurant',
                currentSocialTab: 'userFeed',
                currentBusiness: null,
                currentViewedUser: null,
                currentChatUser: null,
                isProfileOpen: false,
                isChatOpen: false,
                isProfileEditorOpen: false,
                isBusinessProfileEditorOpen: false,
                isUserProfileOpen: false,
                isBusinessUser: false, // Key flag for business vs user
                currentUser: null,
                userProfile: {
                    name: '',
                    age: '',
                    bio: '',
                    birthday: '',
                    zodiac: '',
                    height: '',
                    career: '',
                    interests: [],
                    priority: '',
                    relationship: '',
                    lookingFor: '',
                    marriage: '',
                    photos: []
                
            // User Profile Editor Functions
            openProfileEditor() {
                console.log('✏️ Opening user profile editor');
                document.getElementById('profileEditor').classList.add('show');
                this.state.isProfileEditorOpen = true;
                this.loadProfileData();
            
            // User Profile Viewing Functions (Only for regular users)
            openUserProfile(user) {
                // Only allow user profile viewing for regular users
                if (this.state.isBusinessUser) {
                    console.log('Business users cannot view user profiles');
                    return;
                }
                
                console.log(`👤 Opening ${user.name}'s profile`);
                document.getElementById('userProfileView').classList.add('show');
                this.state.isUserProfileOpen = true;
                this.state.currentViewedUser = user;
                
                // Populate user profile data
                document.getElementById('userProfileTitle').textContent = user.name;
                document.getElementById('userProfileHero').style.backgroundImage = `url('${user.image}')`;
                document.getElementById('userProfileName').textContent = user.name;
                document.getElementById('userProfileAge').textContent = `${user.age} years old`;
                document.getElementById('userProfileMatch').textContent = `${user.matchPercentage}% Match`;
                document.getElementById('userProfileBio').textContent = user.bio;
                document.getElementById('userProfileDistance').textContent = user.distance;
                document.getElementById('userProfileStatus').textContent = user.isOnline ? 'Online Now' : 'Offline';
                document.getElementById('userProfileCategory').textContent = user.category === 'nomads' ? 'Digital Nomad' : 'Traveler';
                
                // Update interests
                const interestsContainer = document.getElementById('userProfileInterests');
                interestsContainer.innerHTML = user.interests.map(interest => 
                    `<span class="interest-tag">${interest}</span>`
                ).join('');
            
            // Business Profile Functions
            openBusinessProfile(businessId, type) {
                console.log(`🏪 Opening ${businessId} profile`);
                const businesses = type === 'restaurant' ? this.data.restaurants : this.data.activities;
                const business = businesses.find(b => b.id === businessId);
                if (!business) {
                    console.error('Business not found:', businessId);
                    return;
                }
                
                // Show profile overlay
                const profile = document.getElementById('businessProfile');
                profile.classList.add('show');
                this.state.isProfileOpen = true;
                this.state.currentBusiness = { business, type };
                
                // Populate profile data
                document.getElementById('profileHeaderTitle').textContent = business.name;
                document.getElementById('profileHero').style.backgroundImage = `url('${business.image}')`;
                document.getElementById('profileName').textContent = business.name;
                document.getElementById('profileType').textContent = business.type;
                document.getElementById('profilePromoTitle').textContent = business.promo;
                document.getElementById('profilePromoDetails').textContent = business.details;
                document.getElementById('profileDescription').textContent = business.description;
                document.getElementById('profileLocation').textContent = business.location;
                document.getElementById('profileHours').textContent = business.hours;
                document.getElementById('profilePrice').textContent = business.price;
                document.getElementById('profileContact').textContent = business.contact;
            },
            
            closeBusinessProfile() {
                console.log('🔙 Closing business profile');
                document.getElementById('businessProfile').classList.remove('show');
                this.state.isProfileOpen = false;
                this.state.currentBusiness = null;
            },
            
            shareBusinessProfile() {
                if (this.state.currentBusiness) {
                    const business = this.state.currentBusiness.business;
                    const shareText = `Check out ${business.name} in Hoi An! ${business.promo}`;
                    if (navigator.share) {
                        navigator.share({
                            title: business.name,
                            text: shareText,
                            url: window.location.href
                        });
                    } else {
                        navigator.clipboard.writeText(shareText + ' - ' + window.location.href);
                        alert('Business info copied to clipboard! 📋');
                    }
                }
            },
            
            getDirections() {
                if (this.state.currentBusiness) {
                    const business = this.state.currentBusiness.business;
                    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(business.location)}`;
                    window.open(mapsUrl, '_blank');
                }
            },
            
            // User Feed - Only for regular users
            async populateUserFeed() {
                if (!this.state.isAuthenticated || this.state.isBusinessUser) return;
                
                const container = document.getElementById('userFeedContainer');
                if (!container) return;
                
                container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                try {
                    // Fetch real users from Firebase
                    const snapshot = await window.db.collection('users')
                        .where('uid', '!=', this.state.currentUser.uid)
                        .limit(10)
                        .get();
                    
                    const users = [];
                    snapshot.forEach(doc => {
                        const userData = doc.data();
                        users.push({
                            id: doc.id,
                            name: userData.name || 'Anonymous',
                            age: userData.age || 25,
                            image: userData.photos?.[0] || userData.photo || 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop',
                            interests: userData.interests || ['Travel', 'Adventure'],
                            bio: userData.bio || 'Exploring Hoi An and meeting new people!',
                            isOnline: Math.random() > 0.5,
                            distance: `${Math.floor(Math.random() * 5) + 1} km`,
                            matchPercentage: Math.floor(Math.random() * 30) + 70,
                            category: userData.category || 'all'
                        });
                    });
                    
                    // If no users found, show demo users
                    if (users.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; opacity: 0.7;">
                                <div style="font-size: 48px; margin-bottom: 20px;">👥</div>
                                <div style="font-size: 18px; margin-bottom: 10px;">No travelers nearby yet!</div>
                                <div style="font-size: 14px;">Be the first to complete your profile and start connecting.</div>
                            </div>
                        `;
                        return;
                    }
                    
                    // Populate with real users
                    container.innerHTML = '';
                    users.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                    
                    console.log(`👥 User feed populated with ${users.length} real users`);
                } catch (error) {
                    console.error('❌ Error loading users:', error);
                    // Fallback to demo users
                    container.innerHTML = '';
                    this.data.users.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                }
            },
            
            filterUsers(filter) {
                if (this.state.isBusinessUser) return;
                
                console.log(`🔍 Filtering users by: ${filter}`);
                
                // Update active filter chip
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                const activeChip = document.querySelector(`[data-filter="${filter}"]`);
                if (activeChip) {
                    activeChip.classList.add('active');
                }
                
                // Filter users based on criteria
                let filteredUsers = this.data.users;
                if (filter === 'online') {
                    filteredUsers = this.data.users.filter(user => user.isOnline);
                } else if (filter === 'nearby') {
                    filteredUsers = this.data.users.filter(user => {
                        const distance = parseFloat(user.distance);
                        return distance < 2;
                    });
                } else if (filter === 'nomads') {
                    filteredUsers = this.data.users.filter(user => user.category === 'nomads');
                }
                
                // Re-populate feed with filtered users
                const container = document.getElementById('userFeedContainer');
                if (container) {
                    container.innerHTML = '';
                    filteredUsers.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                }
            },
            
            createUserFeedItem(user, index) {
                const feedItem = document.createElement('div');
                feedItem.className = 'user-feed-item';
                feedItem.style.animationDelay = `${index * 0.1}s`;
                feedItem.style.cursor = 'pointer';
                
                // Make the entire card clickable to view profile
                feedItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-actions')) {
                        this.openUserProfile(user);
                    }
                });
                
                feedItem.innerHTML = `
                    <div class="user-status-badges">
                        ${user.isOnline ? '<div class="status-badge status-online">🟢 Online</div>' : ''}
                        <div class="status-badge status-distance">📍 ${user.distance}</div>
                        <div class="status-badge status-match">🔥 ${user.matchPercentage}% Match</div>
                    </div>
                    <div class="user-image" style="background-image: url('${user.image}')">
                        <div class="user-image-overlay">
                            <div class="user-name">${user.name}, ${user.age}</div>
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-bio">${user.bio}</div>
                        <div class="user-interests">
                            ${user.interests.map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                        </div>
                        <div class="user-actions">
                            <button class="action-btn pass-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('pass', '${user.name}')">✕ Pass</button>
                            <button class="action-btn chat-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('like', '${user.name}')">💬 Chat</button>
                            <button class="action-btn super-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('superlike', '${user.name}')">⭐ Super</button>
                        </div>
                    </div>
                `;
                return feedItem;
            },
            
            handleUserAction(action, userName) {
                if (this.state.isBusinessUser) return;
                
                console.log(`👆 ${action} action for ${userName}`);
                
                if (!userName && this.state.currentViewedUser) {
                    userName = this.state.currentViewedUser.name;
                }
                
                if (action === 'like' || action === 'superlike') {
                    if (this.state.isUserProfileOpen) {
                        this.closeUserProfile();
                    }
                    
                    if (userName === 'Jessica') {
                        setTimeout(() => this.showMatchPopup(), 500);
                    } else {
                        setTimeout(() => {
                            alert(`You liked ${userName}! 💕 They'll be notified when they're online.`);
                        }, 300);
                    }
                } else if (action === 'pass') {
                    if (this.state.isUserProfileOpen) {
                        this.closeUserProfile();
                    }
                    setTimeout(() => {
                        console.log(`Passed on ${userName}`);
                    }, 300);
                }
            },
            
            showMatchPopup() {
                if (this.state.isBusinessUser) return;
                document.getElementById('matchPopup').classList.add('show');
            },
            
            startChatFromMatch() {
                if (this.state.isBusinessUser) return;
                document.getElementById('matchPopup').classList.remove('show');
                this.openChatWithUser('Jessica');
            },
            
            // Messaging - Only for regular users
            populateMessaging() {
                if (this.state.isBusinessUser) return;
                
                const matchesContainer = document.getElementById('matchesScroll');
                const chatListContainer = document.getElementById('chatList');
                
                if (matchesContainer) {
                    matchesContainer.innerHTML = this.data.users.slice(0, 3).map(user => 
                        `<div class="match-avatar" style="background-image: url('${user.image}')" 
                             onclick="CLASSIFIED.openChatWithUser('${user.name}')"></div>`
                    ).join('');
                }
                
                if (chatListContainer) {
                    chatListContainer.innerHTML = this.data.chats.map(chat => 
                        `<div class="chat-item" onclick="CLASSIFIED.openChatWithUser('${chat.name}')">
                            <div class="chat-avatar" style="background-image: url('${chat.avatar}')"></div>
                            <div class="chat-info">
                                <div class="chat-name">${chat.name}</div>
                                <div class="chat-message">${chat.message}</div>
                            </div>
                            <div class="chat-time">${chat.time}</div>
                        </div>`
                    ).join('');
                }
                console.log('💬 Messaging populated');
            },
            
            openChat(name, avatar) {
                if (this.state.isBusinessUser) return;
                
                console.log(`💬 Opening chat with ${name}`);
                const chat = document.getElementById('individualChat');
                chat.classList.add('show');
                this.state.isChatOpen = true;
                
                const user = this.data.users.find(u => u.name === name);
                this.state.currentChatUser = user;
                
                document.getElementById('chatName').textContent = name;
                document.getElementById('chatAvatar').style.backgroundImage = `url('${avatar}')`;
            },
            
            openChatWithUser(userName) {
                if (this.state.isBusinessUser) return;
                
                console.log(`💬 Opening chat with user: ${userName}`);
                
                const user = this.data.users.find(u => u.name === userName);
                
                if (user) {
                    console.log('✅ Found user object:', user);
                    this.state.currentChatUser = user;
                    this.openChat(user.name, user.image);
                } else {
                    console.error('❌ Could not find user:', userName);
                    this.openChat(userName, '');
                }
            },
            
            closeChat() {
                console.log('🔙 Closing chat');
                document.getElementById('individualChat').classList.remove('show');
                this.state.isChatOpen = false;
                this.state.currentChatUser = null;
            },
            
            sendMessage() {
                const input = document.getElementById('messageInput');
                const messages = document.getElementById('chatMessages');
                if (input.value.trim()) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message sent';
                    messageDiv.innerHTML = `<div class="message-bubble">${input.value}</div>`;
                    messages.appendChild(messageDiv);
                    messages.scrollTop = messages.scrollHeight;
                    input.value = '';
                    console.log('📨 Message sent');
                }
            }
        };
        
        // Make CLASSIFIED globally available for onclick handlers
        window.CLASSIFIED = CLASSIFIED;
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 DOM loaded, initializing CLASSIFIED...');
            CLASSIFIED.init();
        });
         closeUserProfile() {
                console.log('🔙 Closing user profile');
                document.getElementById('userProfileView').classList.remove('show');
                this.state.isUserProfileOpen = false;
                this.state.currentViewedUser = null;
            },
            
            startChatWithViewedUser() {
                if (this.state.currentViewedUser) {
                    const user = this.state.currentViewedUser;
                    this.closeUserProfile();
                    setTimeout(() => {
                        this.openChatWithUser(user.name);
                    }, 300);
                }
            },
            
            openProfileFromChat() {
                console.log('🔍 Opening profile from chat');
                console.log('Current chat user state:', this.state.currentChatUser);
                
                // Only allow for regular users
                if (this.state.isBusinessUser) {
                    console.log('Business users cannot view user profiles from chat');
                    return;
                }
                
                let user = null;
                
                if (this.state.currentChatUser) {
                    user = this.state.currentChatUser;
                    console.log('✅ Found user from currentChatUser:', user.name);
                } else {
                    const chatNameElement = document.getElementById('chatName');
                    const chatName = chatNameElement ? chatNameElement.textContent.trim() : '';
                    console.log('🔄 Looking up user by chat name:', chatName);
                    
                    if (chatName) {
                        user = this.data.users.find(u => u.name.trim() === chatName);
                        if (user) {
                            console.log('✅ Found user by name lookup:', user.name);
                            this.state.currentChatUser = user;
                        }
                    }
                }
                
                if (user) {
                    console.log('🚀 Opening user profile for:', user.name);
                    this.openUserProfile(user);
                } else {
                    console.error('❌ Could not find user data');
                    alert('Could not load user profile. Please try again.');
                }
            },
            
            // Screen Management
            showScreen(screenType) {
                console.log(`📱 Switching to ${screenType} screen`);
                
                // Business users have different available screens
                if (this.state.isBusinessUser) {
                    // Restrict business users from social features
                    if (screenType === 'social') {
                        console.log('❌ Business users cannot access social features');
                        return;
                    }
                }
                
                // Update state
                this.state.currentScreen = screenType;
                
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Show target screen
                const targetScreen = document.getElementById(`${screenType}Screen`);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                }
                
                // Update navigation - different nav bars for business vs user
                if (this.state.isBusinessUser) {
                    document.querySelectorAll('.business-nav .nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    const activeItem = document.querySelector(`.business-nav [data-screen="${screenType}"]`);
                    if (activeItem) {
                        activeItem.classList.add('active');
                    }
                } else {
                    document.querySelectorAll('.user-nav .nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    const activeItem = document.querySelector(`.user-nav [data-screen="${screenType}"]`);
                    if (activeItem) {
                        activeItem.classList.add('active');
                    }
                }
                
                // Reset social tab to userFeed when leaving social screen
                if (screenType !== 'social') {
                    this.switchSocialTab('userFeed');
                }
            },
            
            switchSocialTab(tabType) {
                // Only for regular users
                if (this.state.isBusinessUser) return;
                
                console.log(`🔄 Switching to ${tabType} tab`);
                this.state.currentSocialTab = tabType;
                
                // Update tabs
                document.querySelectorAll('.social-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                const activeTab = document.querySelector(`[data-tab="${tabType}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
                
                // Update content
                document.querySelectorAll('.social-content').forEach(content => {
                    content.classList.remove('active');
                });
                const activeContent = document.getElementById(`${tabType}Content`);
                if (activeContent) {
                    activeContent.classList.add('active');
                }
            },
            
            // Populate Feeds
            populateFeeds() {
                this.populateRestaurantFeed();
                this.populateActivityFeed();
            },
            
            populateRestaurantFeed() {
                const storiesContainer = document.getElementById('restaurantStories');
                const feedContainer = document.getElementById('restaurantFeed');
                
                // Stories
                if (storiesContainer) {
                    storiesContainer.innerHTML = this.data.restaurants.map(restaurant => 
                        `<div class="story-item" style="background-image: url('${restaurant.story}')">
                            <div class="story-overlay">
                                <div class="story-title">${restaurant.name}</div>
                                <div class="story-subtitle">${restaurant.type}</div>
                            </div>
                        </div>`
                    ).join('');
                }
                
                // Feed
                if (feedContainer) {
                    feedContainer.innerHTML = this.data.restaurants.map(restaurant => 
                        this.createBusinessCard(restaurant, 'restaurant')
                    ).join('');
                }
                console.log('🍽️ Restaurant feed populated');
            },
            
            populateActivityFeed() {
                const storiesContainer = document.getElementById('activityStories');
                const feedContainer = document.getElementById('activityFeed');
                
                // Stories
                if (storiesContainer) {
                    storiesContainer.innerHTML = this.data.activities.map(activity => 
                        `<div class="story-item" style="background-image: url('${activity.story}')">
                            <div class="story-overlay">
                                <div class="story-title">${activity.name}</div>
                                <div class="story-subtitle">${activity.type}</div>
                            </div>
                        </div>`
                    ).join('');
                }
                
                // Feed
                if (feedContainer) {
                    feedContainer.innerHTML = this.data.activities.map(activity => 
                        this.createBusinessCard(activity, 'activity')
                    ).join('');
                }
                console.log('🎯 Activity feed populated');
            },
            
            createBusinessCard(business, type) {
                return `
                    <div class="business-card" onclick="CLASSIFIED.openBusinessProfile('${business.id}', '${type}')">
                        <div class="business-header">
                            <div class="business-logo" style="background-image: url('${business.logo}')"></div>
                            <div class="business-info">
                                <h3>${business.name}</h3>
                                <p>${business.type}</p>
                            </div>
                        </div>
                        <div class="business-image" style="background-image: url('${business.image}')"></div>
                        <div class="business-content">
                            <div class="business-description">${business.description.substring(0, 100)}...</div>
                            <div class="business-promo">
                                <div class="promo-title">${business.promo}</div>
                                <div class="promo-details">${business.details}</div>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            closeProfileEditor() {
                console.log('🔙 Closing user profile editor');
                document.getElementById('profileEditor').classList.remove('show');
                this.state.isProfileEditorOpen = false;
            },
            
            viewMyProfile() {
                console.log('👤 Viewing my profile');
                this.closeProfileEditor();
                document.getElementById('myProfileView').classList.add('show');
                this.updateMyProfileView();
            },
            
            closeMyProfile() {
                console.log('🔙 Closing my profile');
                document.getElementById('myProfileView').classList.remove('show');
            },
            
            loadProfileData() {
                const profile = this.state.userProfile;
                
                // Load basic info
                document.getElementById('profileBio').value = profile.bio || '';
                document.getElementById('profileBirthday').value = profile.birthday || '';
                document.getElementById('profileHeight').value = profile.height || '';
                
                // Load choices
                if (profile.zodiac) this.selectChoiceByValue('zodiac', profile.zodiac);
                if (profile.career) this.selectChoiceByValue('career', profile.career);
                if (profile.priority) this.selectChoiceByValue('priority', profile.priority);
                if (profile.relationship) this.selectChoiceByValue('relationship', profile.relationship);
                if (profile.lookingFor) this.selectChoiceByValue('lookingFor', profile.lookingFor);
                if (profile.marriage) this.selectChoiceByValue('marriage', profile.marriage);
                
                // Load interests
                document.querySelectorAll('.interest-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (profile.interests && profile.interests.includes(btn.dataset.interest)) {
                        btn.classList.add('active');
                    }
                });
            },
            
            selectChoice(choiceType, value, buttonElement) {
                // Remove active from siblings
                const siblings = buttonElement.parentElement.querySelectorAll('.choice-btn');
                siblings.forEach(btn => btn.classList.remove('active'));
                
                // Add active to clicked button
                buttonElement.classList.add('active');
                
                // Update state - choose correct profile based on user type
                if (this.state.isBusinessUser) {
                    this.state.businessProfile[choiceType] = value;
                } else {
                    this.state.userProfile[choiceType] = value;
                }
                console.log(`Selected ${choiceType}: ${value}`);
            },
            
            selectChoiceByValue(choiceType, value) {
                const btn = document.querySelector(`[data-choice="${choiceType}"][data-value="${value}"]`);
                if (btn) {
                    this.selectChoice(choiceType, value, btn);
                }
            },
            
            toggleInterest(buttonElement) {
                const interest = buttonElement.dataset.interest;
                const isActive = buttonElement.classList.contains('active');
                
                if (!this.state.userProfile.interests) {
                    this.state.userProfile.interests = [];
                }
                
                if (isActive) {
                    buttonElement.classList.remove('active');
                    this.state.userProfile.interests = this.state.userProfile.interests.filter(i => i !== interest);
                } else {
                    if (this.state.userProfile.interests.length < 8) { // Limit to 8 interests
                        buttonElement.classList.add('active');
                        this.state.userProfile.interests.push(interest);
                    } else {
                        alert('You can select up to 8 interests!');
                    }
                }
                console.log('Current interests:', this.state.userProfile.interests);
            },
            
            uploadPhoto(slotIndex) {
                // TODO: Implement Firebase Storage photo upload
                // For now, simulate photo upload with demo images
                const photos = [
                    'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1494790108755-2616b1e78f41?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=400&h=400&fit=crop'
                ];
                
                if (slotIndex !== undefined) {
                    const slot = document.querySelectorAll('#photoGrid .photo-slot')[slotIndex];
                    if (slot && !slot.classList.contains('filled')) {
                        const photoUrl = photos[slotIndex];
                        slot.style.backgroundImage = `url('${photoUrl}')`;
                        slot.classList.add('filled');
                        slot.innerHTML = slotIndex === 0 ? '<div class="star-icon">⭐</div>' : '';
                        
                        if (!this.state.userProfile.photos) {
                            this.state.userProfile.photos = [];
                        }
                        this.state.userProfile.photos[slotIndex] = photoUrl;
                        console.log(`Photo uploaded to slot ${slotIndex}`);
                    }
                } else {
                    alert('Tap on a photo slot to add your image! 📸\n\n(Firebase Storage integration coming soon)');
                }
            },
            
            // Settings & Account Management
            openSettings() {
                const isBusinessUser = this.state.isBusinessUser;
                const profileButtonText = isBusinessUser ? '🏪 Edit Business Profile' : '✏️ Edit Profile';
                const viewButtonText = isBusinessUser ? '🏪 View My Business' : '👤 View My Profile';
                const profileAction = isBusinessUser ? 'CLASSIFIED.openBusinessProfileEditor()' : 'CLASSIFIED.openProfileEditor()';
                const viewAction = isBusinessUser ? 'CLASSIFIED.viewMyBusinessProfile()' : 'CLASSIFIED.viewMyProfile()';
                
                const settingsMenu = `
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 500; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
                        <div style="background: #2a2a2a; border-radius: 20px; padding: 30px; max-width: 300px; width: 90%; border: 1px solid rgba(255,255,255,0.1);" onclick="event.stopPropagation()">
                            <h3 style="margin: 0 0 20px 0; text-align: center; color: #00D4FF;">Settings</h3>
                            <button onclick="${profileAction}; this.closest('.settings-overlay').remove();" style="width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; cursor: pointer;">${profileButtonText}</button>
                            <button onclick="${viewAction}; this.closest('.settings-overlay').remove();" style="width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; cursor: pointer;">${viewButtonText}</button>
                            <button onclick="CLASSIFIED.logout(); this.closest('.settings-overlay').remove();" style="width: 100%; padding: 12px; background: rgba(255,107,107,0.2); border: 1px solid rgba(255,107,107,0.3); border-radius: 10px; color: #FF6B6B; cursor: pointer;">🚪 Logout</button>
                        </div>
                    </div>
                `;
                
                const overlay = document.createElement('div');
                overlay.className = 'settings-overlay';
                overlay.innerHTML = settingsMenu;
                document.body.appendChild(overlay);
            },
            
            updateMyProfileView() {
                const profile = this.state.userProfile;
                
                // Update profile view with user data
                document.getElementById('myProfileName').textContent = profile.name || 'Your Name';
                document.getElementById('myProfileAge').textContent = profile.age ? `${profile.age} years old` : 'Add your age';
                document.getElementById('myProfileBio').textContent = profile.bio || 'Complete your profile to start connecting with amazing people in Hoi An!';
                
                // Update details
                document.getElementById('myProfileAgeDetail').textContent = profile.age || '-';
                document.getElementById('myProfileHeightDetail').textContent = profile.height || '-';
                document.getElementById('myProfileCareerDetail').textContent = profile.career || '-';
                document.getElementById('myProfileZodiacDetail').textContent = profile.zodiac || '-';
                document.getElementById('myProfileLookingForDetail').textContent = profile.lookingFor || '-';
                
                // Update interests
                const interestsContainer = document.getElementById('myProfileInterests');
                if (profile.interests && profile.interests.length > 0) {
                    interestsContainer.innerHTML = profile.interests.map(interest => 
                        `<span class="interest-tag">${interest}</span>`
                    ).join('');
                } else {
                    interestsContainer.innerHTML = '<span class="interest-tag">Add interests in profile editor</span>';
                }
                
                // Update hero image if photos available
                if (profile.photos && profile.photos.length > 0) {
                    document.getElementById('myProfileHero').style.backgroundImage = `url('${profile.photos[0]}')`;
                }
            },
            
            shareMyProfile() {
                const shareText = `Check out my profile on CLASSIFIED Hoi An! 🌟`;
                if (navigator.share) {
                    navigator.share({
                        title: 'My CLASSIFIED Profile',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText + ' - ' + window.location.href);
                    alert('Profile link copied to clipboard! 📋');
                }
            },
                businessProfile: {
                    name: '',
                    description: '',
                    address: '',
                    phone: '',
                    website: '',
                    category: '',
                    weekdayOpen: '',
                    weekdayClose: '',
                    weekendOpen: '',
                    weekendClose: '',
                    priceRange: '',
                    audience: [],
                    amenities: [],
                    photos: []
            
            // UI Helper Methods
            showLogin() {
                document.getElementById('loginScreen').classList.add('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.querySelector('.main-screens').classList.remove('authenticated');
                document.querySelector('.user-nav').style.display = 'none';
                document.querySelector('.business-nav').classList.remove('show');
            },
            
            showRegister() {
                document.getElementById('registerScreen').classList.add('show');
                document.getElementById('loginScreen').classList.remove('show');
            },
            
            hideAuthScreens() {
                document.getElementById('loginScreen').classList.remove('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.querySelector('.main-screens').classList.add('authenticated');
                this.hideLoading();
            },
            
            showLoading() {
                document.getElementById('loadingOverlay').classList.add('show');
            },
            
            hideLoading() {
                document.getElementById('loadingOverlay').classList.remove('show');
            },
            
            // Business Profile Editor Functions
            openBusinessProfileEditor() {
                console.log('🏪 Opening business profile editor');
                document.getElementById('businessProfileEditor').classList.add('show');
                this.state.isBusinessProfileEditorOpen = true;
                this.loadBusinessProfileData();
            },
            
            closeBusinessProfileEditor() {
                console.log('🔙 Closing business profile editor');
                document.getElementById('businessProfileEditor').classList.remove('show');
                this.state.isBusinessProfileEditorOpen = false;
            },
            
            viewMyBusinessProfile() {
                console.log('🏪 Viewing my business profile');
                this.closeBusinessProfileEditor();
                document.getElementById('myBusinessProfileView').classList.add('show');
                this.updateMyBusinessProfileView();
            },
            
            closeMyBusinessProfile() {
                console.log('🔙 Closing my business profile');
                document.getElementById('myBusinessProfileView').classList.remove('show');
            },
            
            loadBusinessProfileData() {
                const profile = this.state.businessProfile;
                
                // Load basic info
                document.getElementById('businessName').value = profile.name || '';
                document.getElementById('businessDescription').value = profile.description || '';
                document.getElementById('businessAddress').value = profile.address || '';
                document.getElementById('businessPhone').value = profile.phone || '';
                document.getElementById('businessWebsite').value = profile.website || '';
                
                // Load hours
                document.getElementById('weekdayOpen').value = profile.weekdayOpen || '';
                document.getElementById('weekdayClose').value = profile.weekdayClose || '';
                document.getElementById('weekendOpen').value = profile.weekendOpen || '';
                document.getElementById('weekendClose').value = profile.weekendClose || '';
                
                // Load choices
                if (profile.category) this.selectBusinessChoiceByValue('businessCategory', profile.category);
                if (profile.priceRange) this.selectBusinessChoiceByValue('priceRange', profile.priceRange);
                
                // Load audience
                document.querySelectorAll('[data-business-audience]').forEach(btn => {
                    btn.classList.remove('active');
                    if (profile.audience && profile.audience.includes(btn.dataset.businessAudience)) {
                        btn.classList.add('active');
                    }
                });
                
                // Load amenities
                document.querySelectorAll('[data-business-amenity]').forEach(btn => {
                    btn.classList.remove('active');
                    if (profile.amenities && profile.amenities.includes(btn.dataset.businessAmenity)) {
                        btn.classList.add('active');
                    }
                });
            },
            
            selectBusinessChoiceByValue(choiceType, value) {
                const btn = document.querySelector(`[data-choice="${choiceType}"][data-value="${value}"]`);
                if (btn) {
                    this.selectChoice(choiceType, value, btn);
                }
            },
            
            updateMyBusinessProfileView() {
                const profile = this.state.businessProfile;
                
                // Update profile view with business data
                document.getElementById('myBusinessProfileName').textContent = profile.name || 'Your Business';
                document.getElementById('myBusinessProfileCategory').textContent = profile.category || 'Category';
                document.getElementById('myBusinessProfileDescription').textContent = profile.description || 'Complete your business profile to start attracting customers in Hoi An!';
                
                // Update details
                document.getElementById('myBusinessProfileAddress').textContent = profile.address || '-';
                document.getElementById('myBusinessProfilePhone').textContent = profile.phone || '-';
                document.getElementById('myBusinessProfileHours').textContent = profile.hours || '-';
                document.getElementById('myBusinessProfilePrice').textContent = profile.priceRange || '-';
                
                // Update audience
                const audienceContainer = document.getElementById('myBusinessProfileAudience');
                if (profile.audience && profile.audience.length > 0) {
                    audienceContainer.innerHTML = profile.audience.map(audience => 
                        `<span class="interest-tag">${audience}</span>`
                    ).join('');
                } else {
                    audienceContainer.innerHTML = '<span class="interest-tag">Add target audience in profile editor</span>';
                }
                
                // Update amenities
                const amenitiesContainer = document.getElementById('myBusinessProfileAmenities');
                if (profile.amenities && profile.amenities.length > 0) {
                    amenitiesContainer.innerHTML = profile.amenities.map(amenity => 
                        `<span class="interest-tag">${amenity}</span>`
                    ).join('');
                } else {
                    amenitiesContainer.innerHTML = '<span class="interest-tag">Add amenities in profile editor</span>';
                }
                
                // Update hero image if photos available
                if (profile.photos && profile.photos.length > 0) {
                    document.getElementById('myBusinessProfileHero').style.backgroundImage = `url('${profile.photos[0]}')`;
                }
            },
            
            shareMyBusinessProfile() {
                const shareText = `Check out my business on CLASSIFIED Hoi An! 🏪`;
                if (navigator.share) {
                    navigator.share({
                        title: 'My Business Profile',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText + ' - ' + window.location.href);
                    alert('Business profile link copied to clipboard! 📋');
                }
            },
            
            uploadBusinessPhoto(slotIndex) {
                // TODO: Implement Firebase Storage photo upload for businesses
                const photos = [
                    'https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=400&h=400&fit=crop'
                ];
                
                if (slotIndex !== undefined) {
                    const slot = document.querySelectorAll('#businessPhotoGrid .photo-slot')[slotIndex];
                    if (slot && !slot.classList.contains('filled')) {
                        const photoUrl = photos[slotIndex];
                        slot.style.backgroundImage = `url('${photoUrl}')`;
                        slot.classList.add('filled');
                        slot.innerHTML = slotIndex === 0 ? '<div class="star-icon">⭐</div>' : '';
                        
                        if (!this.state.businessProfile.photos) {
                            this.state.businessProfile.photos = [];
                        }
                        this.state.businessProfile.photos[slotIndex] = photoUrl;
                        console.log(`Business photo uploaded to slot ${slotIndex}`);
                    }
                } else {
                    alert('Tap on a photo slot to add your business image! 📸\n\n(Firebase Storage integration coming soon)');
                }
            },
            
            // App Data - Real Hoi An Businesses
            data: {
                users: [
                    {
                        name: "Jessica",
                        age: 28,
                        image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop",
                        interests: ["Reading", "Gym", "Music", "Laughter", "Cafe Connoisseur"],
                        bio: "Backpacker exploring Vietnam 🇻🇳 Looking for adventure buddies and great coffee spots!",
                        isOnline: true,
                        distance: "2 km",
                        matchPercentage: 83,
                        category: "nomads"
                    },
                    {
                        name: "Dave",
                        age: 32,
                        image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop",
                        interests: ["Surfing", "Photography", "Coffee", "Adventure Sports", "Live Music"],
                        bio: "Digital nomad loving Hoi An vibes ✨ Always down for beach days and exploring local culture.",
                        isOnline: false,
                        distance: "1.5 km",
                        matchPercentage: 76,
                        category: "nomads"
                    },
                    {
                        name: "Rebecca",
                        age: 26,
                        image: "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=400&h=600&fit=crop",
                        interests: ["Yoga", "Cooking", "Beach", "Art", "Nightlife"],
                        bio: "Artist seeking creative adventures 🎨 Love painting landscapes and meeting fellow creatives!",
                        isOnline: true,
                        distance: "800m",
                        matchPercentage: 91,
                        category: "all"
                    },
                    {
                        name: "Alex",
                        age: 29,
                        image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=600&fit=crop",
                        interests: ["Hiking", "Beer", "Football", "Travel", "Food"],
                        bio: "Exploring Southeast Asia one city at a time 🌏 Football fanatic and craft beer enthusiast.",
                        isOnline: true,
                        distance: "3.2 km",
                        matchPercentage: 68,
                        category: "all"
                    },
                    {
                        name: "Maria",
                        age: 24,
                        image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop",
                        interests: ["Dancing", "Food", "Travel", "Photography", "Beach"],
                        bio: "Spanish girl making memories in Vietnam 💃 Love salsa dancing and trying street food!",
                        isOnline: false,
                        distance: "4.1 km",
                        matchPercentage: 79,
                        category: "all"
                    },
                    {
                        name: "James",
                        age: 30,
                        image: "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?w=400&h=600&fit=crop",
                        interests: ["Music", "Art", "Coffee", "Culture", "Adventure"],
                        bio: "British musician discovering Southeast Asia 🎸 Looking for jam sessions and cultural experiences.",
                        isOnline: true,
                        distance: "1.8 km",
                        matchPercentage: 85,
                        category: "nomads"
                    }
                ],
                restaurants: [
                    {
                        id: 'banh-mi-queen',
                        name: "Banh Mi Queen",
                        type: "Vietnamese Street Food",
                        image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1551218808-94e220e084d2?w=150&h=200&fit=crop",
                        promo: "2-for-1 Banh Mi Special",
                        details: "Daily 7am-10pm • Perfect for breakfast",
                        description: "Authentic Vietnamese banh mi served fresh daily. A favorite among backpackers for quick, delicious, and affordable meals in the heart of Hoi An Ancient Town.",
                        location: "123 Tran Phu Street, Hoi An",
                        hours: "7:00 AM - 10:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 123 456"
                    },
                    {
                        id: 'thuan-tinh-island-bar',
                        name: "Thuan Tinh Island Bar",
                        type: "Riverside Bar & Grill",
                        image: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=150&h=200&fit=crop",
                        promo: "Happy Hour - 50% Off All Drinks",
                        details: "Daily 4pm-2am • River views & live music",
                        description: "Stunning riverside location with panoramic views of Thu Bon River. Popular with expats and travelers for sunset drinks, live music, and BBQ nights.",
                        location: "Thuan Tinh Island, Hoi An",
                        hours: "4:00 PM - 2:00 AM",
                        price: "$ - Moderate",
                        contact: "+84 235 234 567"
                    },
                    {
                        id: 'streets-restaurant',
                        name: "Streets Restaurant & Cafe",
                        type: "International Cuisine",
                        image: "https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=150&h=200&fit=crop",
                        promo: "Western Breakfast Special",
                        details: "Daily 7am-11pm • WiFi & AC",
                        description: "Western and Vietnamese fusion cuisine in a comfortable, air-conditioned setting. Great for digital nomads with reliable WiFi and international menu options.",
                        location: "45 Le Loi Street, Hoi An",
                        hours: "7:00 AM - 11:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 345 678"
                    },
                    {
                        id: 'moon-sports-bar',
                        name: "Moon Sports Bar",
                        type: "Sports Bar & Nightlife",
                        image: "https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1574391884720-bbc273b7c282?w=150&h=200&fit=crop",
                        promo: "Game Night - Free Pool & Darts",
                        details: "Daily 5pm-late • Live sports & games",
                        description: "The go-to spot for sports lovers and night owls. Multiple screens showing international sports, pool tables, and a lively atmosphere perfect for meeting fellow travelers.",
                        location: "67 Nguyen Thai Hoc, Hoi An",
                        hours: "5:00 PM - 2:00 AM",
                        price: "$ - Moderate", 
                        contact: "+84 235 456 789"
                    },
                    {
                        id: 'lantern-town-coffee',
                        name: "Lantern Town Coffee",
                        type: "Coffee Shop & Co-working",
                        image: "https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=150&h=200&fit=crop",
                        promo: "Digital Nomad Deal - Coffee + WiFi",
                        details: "Daily 6am-10pm • Perfect for remote work",
                        description: "Specialty coffee roasted locally with fast WiFi and comfortable workspaces. The perfect spot for digital nomads and remote workers exploring Hoi An.",
                        location: "12 Bach Dang Street, Hoi An",
                        hours: "6:00 AM - 10:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 567 890"
                    },
                    {
                        id: 'cham-chi',
                        name: "Cham Chi",
                        type: "Restaurant & Bar",
                        image: "https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?w=150&h=200&fit=crop",
                        promo: "Jam Night - Buy One Get 2 Cocktails ",
                        details: "Every Wednesday • Open Mic Night",
                        description: "Hoi An's premier nightlife destination. Three floors of music, rooftop bar with ancient town views.",
                        location: "89 Nguyen Phuc Chu, Hoi An",
                        hours: "10:00 AM - 11:00 PM",
                        price: "$$ - Moderate to High",
                        contact: "+84 235 999 888"
                    },
                    {
                        id: '8-days-a-week',
                        name: "8 Days A Week",
                        type: "Restaurant & Bar",
                        image: "https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?w=150&h=200&fit=crop",
                        promo: "Sunset Special - 30% Off All Cocktails",
                        details: "Jam Night Every Monday • Delicious cocktails close to the beach",
                        description: "Creative fusion cuisine blending Vietnamese and international flavors. Famous for innovative cocktails.",
                        location: "45 Nguyen Phuc Tan, Hoi An",
                        hours: "11:00 AM - 11:00 PM",
                        price: "$$ - Moderate",
                        contact: "+84 235 678 345"
                    }
                ],
                activities: [
                    {
                        id: 'basket-boat-tours',
                        name: "Basket Boat Adventure",
                        type: "Water Sports",
                        image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=150&h=200&fit=crop",
                        promo: "Group Discount - 4+ People Save 30%",
                        details: "Daily tours 8am & 2pm • 3 hours duration",
                        description: "Traditional Vietnamese basket boat tours through coconut forests. Perfect group activity for backpackers wanting to experience local culture and nature.",
                        location: "Coconut Forest, Cam Thanh",
                        hours: "8:00 AM - 5:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 678 901"
                    },
                    {
                        id: 'motorbike-adventures',
                        name: "Hoi An Motorbike Tours",
                        type: "Adventure Tours",
                        image: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=150&h=200&fit=crop",
                        promo: "Sunrise Tour Special - Early Bird 20% Off",
                        details: "Multiple daily tours • All skill levels",
                        description: "Explore the countryside around Hoi An on authentic Vietnamese motorbikes. Safe, guided tours perfect for adventurous travelers wanting to see the real Vietnam.",
                        location: "85 Cua Dai Street, Hoi An",
                        hours: "6:00 AM - 8:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 789 012"
                    },
                    {
                        id: 'lantern-making-class',
                        name: "Traditional Lantern Workshop",
                        type: "Cultural Experience",
                        image: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=150&h=200&fit=crop",
                        promo: "Couples Workshop - Make Lanterns Together",
                        details: "Daily classes 10am & 3pm • Take home your creation",
                        description: "Learn to make traditional Vietnamese lanterns from local artisans. A perfect cultural activity for travelers wanting to create something beautiful and meaningful.",
                        location: "Ancient Town Workshop District",
                        hours: "9:00 AM - 6:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 890 123"
                    },
                    {
                        id: 'cooking-school',
                        name: "Sabirama Cooking School",
                        type: "Culinary Experience",
                        image: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=150&h=200&fit=crop",
                        promo: "Full Day Class - Market Tour Included",
                        details: "Half & full day classes • Vegetarian options",
                        description: "Hands-on Vietnamese cooking classes including market tours. Learn to make pho, banh mi, and other local favorites in a fun, social environment.",
                        location: "Tra Que Vegetable Village",
                        hours: "8:00 AM - 4:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 901 234"
                    },
                    {
                        id: 'beach-club-an-bang',
                        name: "An Bang Beach Club",
                        type: "Beach & Water Sports",
                        image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=150&h=200&fit=crop",
                        promo: "Beach Day Pass - Sunbed + Drink Included",
                        details: "Daily 8am-sunset • Surfboard rental available",
                        description: "Beautiful beach club on An Bang Beach with sunbeds, fresh seafood, and water sports. Perfect for beach lovers and surfers looking to relax and socialize.",
                        location: "An Bang Beach, Hoi An",
                        hours: "8:00 AM - 7:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 012 345"
                    }
                ],
                chats: [
                    {
                        name: "Jessica",
                        message: "Perfect! Want to check it out together? 😊",
                        time: "2m",
                        avatar: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop"
                    },
                    {
                        name: "Dave", 
                        message: "Great surfing spots near Da Nang!",
                        time: "1h",
                        avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop"
                    },
                    {
                        name: "Rebecca",
                        message: "The art scene here is amazing!",
                        time: "3h", 
                        avatar: "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=100&h=100&fit=crop"
                    }
                ]
            },
            
            // Initialize App
            init() {
                console.log('🚀 Starting CLASSIFIED v6.0...');
                
                // Setup authentication listener
                this.setupAuthListener();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Populate static content
                this.populateFeeds();
                this.setupProfileEditor();
                this.setupBusinessProfileEditor();
                
                console.log('✅ CLASSIFIED app ready for users!');
            },
            
            // 🔥 Firebase Authentication Methods
            setupAuthListener() {
                console.log('🔐 Setting up auth listener...');
                if (!window.auth) {
                    console.error('❌ Firebase auth not initialized!');
                    return;
                }
                
                window.auth.onAuthStateChanged((user) => {
                    console.log('🔐 Auth state changed:', user ? user.email : 'No user');
                    
                    if (user) {
                        // User is signed in
                        this.state.currentUser = user;
                        this.state.isAuthenticated = true;
                        this.hideAuthScreens();
                        this.loadUserData(user.uid);
                    } else {
                        // User is signed out
                        this.state.currentUser = null;
                        this.state.isAuthenticated = false;
                        this.state.isBusinessUser = false;
                        this.showLogin();
                    }
                });
            },
            
            async loadUserData(uid) {
                try {
                    // First check if this is a business user
                    const businessDoc = await window.db.collection('businesses').doc(uid).get();
                    
                    if (businessDoc.exists) {
                        // This is a business user
                        console.log('🏪 Business user detected');
                        this.state.isBusinessUser = true;
                        const businessData = businessDoc.data();
                        this.state.businessProfile = { ...this.state.businessProfile, ...businessData };
                        this.setupBusinessInterface();
                    } else {
                        // Check if regular user
                        const userDoc = await window.db.collection('users').doc(uid).get();
                        if (userDoc.exists) {
                            console.log('👤 Regular user detected');
                            this.state.isBusinessUser = false;
                            const userData = userDoc.data();
                            this.state.userProfile = { ...this.state.userProfile, ...userData };
                            this.setupUserInterface();
                            this.populateUserFeed();
                            this.populateMessaging();
                        } else {
                            // New user, determine type and setup
                            console.log('🆕 New user, setting up interface');
                            this.state.isBusinessUser = false;
                            this.setupUserInterface();
                        }
                    }
                } catch (error) {
                    console.error('❌ Error loading user data:', error);
                }
            },
            
            setupUserInterface() {
                console.log('👤 Setting up user interface');
                
                // Hide business elements
                document.querySelectorAll('.business-only').forEach(el => {
                    el.style.display = 'none';
                });
                document.querySelector('.business-nav').classList.remove('show');
                
                // Show user elements
                document.querySelectorAll('.user-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelector('.user-nav').style.display = 'flex';
                
                // Set default screen
                this.showScreen('restaurant');
            },
            
            setupBusinessInterface() {
                console.log('🏪 Setting up business interface');
                
                // Hide user elements
                document.querySelectorAll('.user-only').forEach(el => {
                    el.style.display = 'none';
                });
                document.querySelector('.user-nav').style.display = 'none';
                
                // Show business elements
                document.querySelectorAll('.business-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelector('.business-nav').classList.add('show');
                document.querySelector('.business-nav').style.display = 'flex';
                
                // Set default screen
                this.showScreen('businessDashboard');
            },
            
            async loginWithEmail() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    alert('Please enter email and password');
                    return;
                }
                
                try {
                    this.showLoading();
                    await window.auth.signInWithEmailAndPassword(email, password);
                    console.log('✅ Email login successful');
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Login error:', error);
                    alert('Login failed: ' + error.message);
                }
            },
            
            async registerWithEmail() {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                const accountType = document.querySelector('input[name="accountType"]:checked').value;
                
                console.log('📝 Registration attempt for:', email, 'as', accountType);
                
                if (!name || !email || !password || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Password must be at least 6 characters');
                    return;
                }
                
                if (!window.auth || !window.db) {
                    console.error('❌ Firebase not ready:', { 
                        auth: !!window.auth, 
                        db: !!window.db 
                    });
                    alert('Firebase is still loading. Please wait a few seconds and try again.');
                    return;
                }
                
                try {
                    this.showLoading();
                    console.log('🔐 Creating user account...');
                    
                    const userCredential = await window.auth.createUserWithEmailAndPassword(email, password);
                    console.log('✅ User account created:', userCredential.user.uid);
                    
                    // Update display name
                    await userCredential.user.updateProfile({
                        displayName: name
                    });
                    console.log('✅ Display name set');
                    
                    // Create profile based on account type
                    if (accountType === 'business') {
                        await this.createBusinessProfile(userCredential.user.uid, {
                            name: name,
                            email: email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            location: 'Hoi An, Vietnam',
                            isApproved: true // Auto-approve for demo
                        });
                        console.log('✅ Business profile created');
                    } else {
                        await this.createUserProfile(userCredential.user.uid, {
                            name: name,
                            email: email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            location: 'Hoi An, Vietnam'
                        });
                        console.log('✅ User profile created');
                    }
                    
                    console.log('🎉 Registration completed successfully!');
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Registration failed:', error);
                    alert('Registration failed: ' + error.message);
                }
            },
            
            async loginWithGoogle() {
                console.log('🔍 Attempting Google login...');
                
                if (!window.auth) {
                    console.error('❌ Firebase auth not initialized');
                    alert('Authentication system not ready. Please refresh and try again.');
                    return;
                }
                
                try {
                    this.showLoading();
                    const provider = new firebase.auth.GoogleAuthProvider();
                    console.log('🔧 Google provider created');
                    
                    const result = await window.auth.signInWithPopup(provider);
                    console.log('✅ Google popup completed');
                    
                    // Check if this is a new user
                    const userDoc = await window.db.collection('users').doc(result.user.uid).get();
                    const businessDoc = await window.db.collection('businesses').doc(result.user.uid).get();
                    
                    if (!userDoc.exists && !businessDoc.exists) {
                        // Create regular user profile for new Google user
                        await this.createUserProfile(result.user.uid, {
                            name: result.user.displayName,
                            email: result.user.email,
                            photo: result.user.photoURL,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            location: 'Hoi An, Vietnam'
                        });
                    }
                    
                    console.log('✅ Google login successful');
                } catch (error) {
                    this.hideLoading();
                    console.error('❌ Google login error:', error);
                    
                    if (error.code === 'auth/popup-closed-by-user') {
                        console.log('User closed Google popup');
                    } else {
                        alert('Google login failed: ' + error.message);
                    }
                }
            },
            
            async logout() {
                try {
                    await window.auth.signOut();
                    console.log('✅ Logout successful');
                } catch (error) {
                    console.error('❌ Logout error:', error);
                }
            },
            
            // 🔥 Firestore Methods
            async createUserProfile(uid, profileData) {
                try {
                    await window.db.collection('users').doc(uid).set(profileData);
                    console.log('✅ User profile created in Firestore');
                } catch (error) {
                    console.error('❌ Error creating user profile:', error);
                    throw error;
                }
            },
            
            async createBusinessProfile(uid, profileData) {
                try {
                    await window.db.collection('businesses').doc(uid).set(profileData);
                    console.log('✅ Business profile created in Firestore');
                } catch (error) {
                    console.error('❌ Error creating business profile:', error);
                    throw error;
                }
            },
            
            async saveUserProfile() {
                if (!this.state.currentUser) return;
                
                try {
                    // Gather form data
                    this.state.userProfile.bio = document.getElementById('profileBio').value;
                    this.state.userProfile.birthday = document.getElementById('profileBirthday').value;
                    this.state.userProfile.height = document.getElementById('profileHeight').value;
                    
                    // Calculate age from birthday
                    if (this.state.userProfile.birthday) {
                        const today = new Date();
                        const birthDate = new Date(this.state.userProfile.birthday);
                        let age = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }
                        this.state.userProfile.age = age;
                    }
                    
                    // Save to Firebase
                    await window.db.collection('users').doc(this.state.currentUser.uid).update({
                        ...this.state.userProfile,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log('💾 User profile saved to Firebase:', this.state.userProfile);
                    alert('Profile saved successfully! 🎉');
                    
                    this.closeProfileEditor();
                    setTimeout(() => this.viewMyProfile(), 300);
                } catch (error) {
                    console.error('❌ Error saving profile:', error);
                    alert('Error saving profile: ' + error.message);
                }
            },
            
            async saveBusinessProfile() {
                if (!this.state.currentUser) return;
                
                try {
                    // Gather form data
                    this.state.businessProfile.name = document.getElementById('businessName').value;
                    this.state.businessProfile.description = document.getElementById('businessDescription').value;
                    this.state.businessProfile.address = document.getElementById('businessAddress').value;
                    this.state.businessProfile.phone = document.getElementById('businessPhone').value;
                    this.state.businessProfile.website = document.getElementById('businessWebsite').value;
                    
                    // Gather hours
                    this.state.businessProfile.weekdayOpen = document.getElementById('weekdayOpen').value;
                    this.state.businessProfile.weekdayClose = document.getElementById('weekdayClose').value;
                    this.state.businessProfile.weekendOpen = document.getElementById('weekendOpen').value;
                    this.state.businessProfile.weekendClose = document.getElementById('weekendClose').value;
                    
                    // Format hours for display
                    if (this.state.businessProfile.weekdayOpen && this.state.businessProfile.weekdayClose) {
                        this.state.businessProfile.hours = `Mon-Fri: ${this.state.businessProfile.weekdayOpen} - ${this.state.businessProfile.weekdayClose}`;
                        if (this.state.businessProfile.weekendOpen && this.state.businessProfile.weekendClose) {
                            this.state.businessProfile.hours += `, Sat-Sun: ${this.state.businessProfile.weekendOpen} - ${this.state.businessProfile.weekendClose}`;
                        }
                    }
                    
                    // Save to Firebase
                    await window.db.collection('businesses').doc(this.state.currentUser.uid).update({
                        ...this.state.businessProfile,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log('💾 Business profile saved to Firebase:', this.state.businessProfile);
                    alert('Business profile saved successfully! 🏪');
                    
                    this.closeBusinessProfileEditor();
                    setTimeout(() => this.viewMyBusinessProfile(), 300);
                } catch (error) {
                    console.error('❌ Error saving business profile:', error);
                    alert('Error saving business profile: ' + error.message);
                }
            },

    </script>
</body>
</html>
            
   
