<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASSIFIED - Hoi An Social Discovery</title>
    <meta name="description" content="Discover Hoi An's hidden gems and connect with travelers">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ===== CSS RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #00D4FF;
            --secondary-color: #FFD700;
            --danger-color: #FF6B6B;
            --success-color: #4CAF50;
            --bg-dark: #1a1a1a;
            --bg-darker: #0a0a0a;
            --text-primary: #ffffff;
            --text-secondary: rgba(255,255,255,0.7);
            --border-color: rgba(255,255,255,0.1);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
            --max-width: 768px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #2d2d2d 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* ===== LAYOUT STRUCTURE ===== */
        .app-container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: var(--bg-dark);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .app-container {
                max-width: var(--max-width);
                box-shadow: 0 0 50px rgba(0,0,0,0.5);
            }
        }
        
        /* ===== HEADER STYLES ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }
        
        .back-btn {
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,215,0,0.1);
            transform: scale(1.1);
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }
        
        .settings-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
        }
        
        .match-badge {
            background: rgba(0,212,255,0.2);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid rgba(0,212,255,0.3);
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .match-badge.guest-mode {
            background: rgba(255,215,0,0.2);
            color: var(--secondary-color);
            border-color: rgba(255,215,0,0.3);
        }
        
        .match-badge.business-mode {
            background: rgba(255,107,107,0.2);
            color: var(--danger-color);
            border-color: rgba(255,107,107,0.3);
        }
        
        /* ===== MAIN SCREENS CONTAINER ===== */
        .main-screens {
            position: relative;
            min-height: calc(100vh - 140px);
            padding-bottom: 100px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .main-screens.authenticated {
            display: block;
            opacity: 1;
        }
        
        .screen {
            display: none;
            animation: slideIn 0.3s ease;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* ===== SOCIAL TABS ===== */
        .social-tabs {
            display: flex;
            background: rgba(255,255,255,0.05);
            margin: 20px;
            border-radius: 25px;
            padding: 4px;
            border: 1px solid var(--border-color);
        }
        
        .social-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }
        
        .social-tab.active {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            color: white;
            transform: scale(1.02);
        }
        
        .social-content {
            display: none;
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        
        .social-content.active {
            display: block;
        }
        
        /* ===== SEARCH BAR ===== */
        .search-bar {
            display: flex;
            gap: 10px;
            margin: 20px;
        }
        
        .search-input {
            flex: 1;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        
        .filter-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        /* ===== STORIES SECTION ===== */
        .stories-section {
            padding: 20px;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .stories-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        
        .stories-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .stories-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .story-item {
            flex-shrink: 0;
            width: 120px;
            height: 180px;
            border-radius: 12px;
            background-size: cover;
            background-position: center;
            position: relative;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        
        .story-item:hover {
            transform: scale(1.05);
        }
        
        .story-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 12px;
            border-radius: 0 0 10px 10px;
        }
        
        .story-title {
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }
        
        .story-subtitle {
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* ===== FEED CONTAINER ===== */
        .feed-container {
            padding: 0 20px 20px 20px;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .feed-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .feed-header h3 {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        /* ===== BUSINESS CARDS ===== */
        .business-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .business-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: rgba(0,212,255,0.3);
        }
        
        .business-header {
            padding: 15px;
            display: flex;
            align-items: center;
        }
        
        .business-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
            border: 2px solid var(--border-color);
        }
        
        .business-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .business-info p {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .business-image {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .business-content {
            padding: 15px;
        }
        
        .business-description {
            font-size: 14px;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 12px;
        }
        
        .business-promo {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
        }
        
        .promo-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .promo-details {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* ===== FILTER OPTIONS ===== */
        .filter-options {
            display: flex;
            gap: 12px;
            padding: 0 20px 20px 20px;
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .filter-options::-webkit-scrollbar {
            display: none;
        }
        
        .filter-chip {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 10px 18px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .filter-chip.active {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border-color: var(--primary-color);
            transform: scale(1.02);
        }
        
        .filter-chip:hover:not(.active) {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.3);
        }
        
        /* ===== USER FEED STYLES ===== */
        .user-feed-container {
            height: calc(100vh - 280px);
            overflow-y: auto;
            padding: 0 20px 20px 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .user-feed-item {
            background: linear-gradient(135deg, #2a2a2a 0%, var(--bg-dark) 100%);
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            animation: fadeInUp 0.3s ease;
            position: relative;
            cursor: pointer;
        }
        
        .user-feed-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            border-color: rgba(0,212,255,0.3);
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-status-badges {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 10;
            flex-wrap: wrap;
        }
        
        .status-badge {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .status-online {
            color: var(--success-color);
            border-color: rgba(76,175,80,0.3);
        }
        
        .status-distance {
            color: var(--primary-color);
            border-color: rgba(0,212,255,0.3);
        }
        
        .status-match {
            color: var(--secondary-color);
            border-color: rgba(255,215,0,0.3);
        }
        
        .user-image {
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .user-image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 30px 20px 20px;
        }
        
        .user-info {
            padding: 20px;
        }
        
        .user-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: white;
        }
        
        .user-bio {
            font-size: 15px;
            opacity: 0.9;
            margin-bottom: 18px;
            line-height: 1.5;
        }
        
        .user-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
        }
        
        .interest-tag {
            background: rgba(0, 212, 255, 0.2);
            color: var(--primary-color);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-weight: 500;
        }
        
        .user-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            padding: 0 5px 5px 5px;
        }
        
        .action-btn {
            flex: 1;
            height: 50px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .pass-btn { 
            background: rgba(255,107,107,0.9);
            color: white;
        }
        
        .pass-btn:hover {
            background: var(--danger-color);
        }
        
        .chat-btn { 
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            color: white;
        }
        
        .chat-btn:hover {
            background: linear-gradient(135deg, #0099CC, #0066AA);
        }
        
        .super-btn { 
            background: linear-gradient(135deg, #FFD93D, #FFC107);
            color: white;
        }
        
        .super-btn:hover {
            background: linear-gradient(135deg, #FFC107, #FF9800);
        }
        
        /* ===== MESSAGING STYLES ===== */
        .messaging-container {
            min-height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            background: var(--bg-dark);
        }
        
        .matches-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-dark);
        }
        
        .matches-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .matches-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .matches-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .match-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .match-avatar:hover {
            transform: scale(1.05);
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-dark);
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background 0.3s ease;
        }
        
        .chat-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .chat-message {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .chat-time {
            font-size: 12px;
            opacity: 0.5;
        }
        
        /* ===== OVERLAY SCREENS ===== */
        .overlay-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--bg-dark);
            z-index: 200;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .overlay-screen {
                left: 50%;
                transform: translateX(-50%);
                max-width: var(--max-width);
            }
        }
        
        .overlay-screen.show {
            display: flex;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        @media (min-width: 768px) {
            @keyframes slideUp {
                from { transform: translate(-50%, 100%); }
                to { transform: translate(-50%, 0); }
            }
        }
        
        /* ===== PROFILE EDITOR STYLES ===== */
        .profile-editor {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .profile-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .form-input {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input::placeholder {
            color: var(--text-secondary);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .choice-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .choice-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        .choice-btn.active {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border-color: var(--primary-color);
        }
        
        .choice-btn:hover:not(.active) {
            background: rgba(255,255,255,0.2);
        }
        
        .photo-upload-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px dashed rgba(255,255,255,0.2);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .photo-upload-section:hover {
            border-color: var(--primary-color);
            background: rgba(0,212,255,0.1);
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .photo-slot {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px dashed rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .photo-slot:hover {
            border-color: var(--primary-color);
            background: rgba(0,212,255,0.1);
        }
        
        .photo-slot.filled {
            background-size: cover;
            background-position: center;
            border: 2px solid var(--primary-color);
        }
        
        .photo-slot .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,0,0,0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: none;
            font-size: 12px;
        }
        
        .photo-slot.filled:hover .remove-photo {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .star-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: var(--secondary-color);
            font-size: 20px;
        }
        
        .interests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .interest-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .interest-btn.active {
            background: rgba(0, 212, 255, 0.2);
            color: var(--primary-color);
            border-color: rgba(0, 212, 255, 0.3);
        }
        
        .save-profile-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border: none;
            border-radius: 25px;
            padding: 15px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .save-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,212,255,0.3);
        }
        
        .save-profile-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ===== PROFILE VIEW STYLES ===== */
        .profile-hero {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .profile-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 30px 20px 20px;
        }
        
        .profile-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .profile-type {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .profile-rating {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stars {
            color: var(--secondary-color);
            font-size: 16px;
        }
        
        .profile-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .profile-description {
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .profile-details {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-value {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .current-promo {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .promo-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: rgba(0,0,0,0.9);
            border-top: 1px solid var(--border-color);
        }
        
        .action-button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
        }
        
        .primary-btn {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            color: white;
        }
        
        .secondary-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        /* ===== CHAT STYLES ===== */
        .chat-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
        }
        
        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin: 0 15px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .chat-header-avatar:hover {
            transform: scale(1.05);
        }
        
        .chat-header-info {
            flex: 1;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }
        
        .chat-header-info:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .chat-header-info:hover .chat-header-name {
            color: var(--primary-color);
        }
        
        .chat-header-name {
            font-weight: 600;
            margin-bottom: 2px;
            transition: color 0.2s ease;
        }
        
        .chat-status {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
            animation: messageAppear 0.3s ease;
        }
        
        .message.sent {
            justify-content: flex-end;
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .message.received .message-bubble {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .message.sent .message-bubble {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            color: white;
        }
        
        .promo-message-card {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            max-width: 250px;
        }
        
        .chat-input {
            display: flex;
            padding: 20px;
            background: rgba(0,0,0,0.95);
            border-top: 1px solid var(--border-color);
        }
        
        .chat-input input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            margin-right: 10px;
        }
        
        .chat-input input::placeholder {
            color: var(--text-secondary);
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .send-btn {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: transform 0.2s ease;
        }
        
        .send-btn:hover {
            transform: scale(1.05);
        }
        
        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: none;
            justify-content: space-around;
            border-top: 1px solid var(--border-color);
            z-index: 150;
        }
        
        @media (min-width: 768px) {
            .bottom-nav {
                left: 50%;
                transform: translateX(-50%);
                max-width: var(--max-width);
            }
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 70px;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            transform: translateY(-2px);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        /* ===== MATCH POPUP ===== */
        .match-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .match-popup.show {
            display: flex;
        }
        
        .match-content {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #2a2a2a, var(--bg-dark));
            border-radius: 20px;
            border: 1px solid var(--border-color);
            max-width: 300px;
            animation: popIn 0.3s ease;
        }
        
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .match-text {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .match-btn {
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .match-btn:hover {
            transform: scale(1.05);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ===== AUTH SCREENS STYLES ===== */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #2d2d2d 100%);
            z-index: 300;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .auth-screen {
                left: 50%;
                transform: translateX(-50%);
                max-width: var(--max-width);
            }
        }
        
        .auth-screen.show {
            display: flex;
        }
        
        .auth-header {
            text-align: center;
            padding: 60px 20px 40px;
        }
        
        .auth-logo {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--secondary-color), #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .auth-tagline {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 40px;
        }
        
        .auth-form {
            padding: 0 30px;
            flex: 1;
        }
        
        .auth-input {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .auth-input::placeholder {
            color: var(--text-secondary);
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
        }
        
        select.auth-input {
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
        }
        
        select.auth-input option {
            background: var(--bg-dark);
            color: white;
        }
        
        .auth-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), #0099CC);
            border: none;
            border-radius: 25px;
            padding: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,212,255,0.3);
        }
        
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .google-btn {
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .google-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .guest-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .guest-btn:hover {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 6px 20px rgba(255,255,255,0.1);
        }
        
        .business-btn {
            background: linear-gradient(135deg, #FF6B6B, #FF8C42);
            color: white;
        }
        
        .business-btn:hover {
            background: linear-gradient(135deg, #FF8C42, #FF6B6B);
            box-shadow: 0 6px 20px rgba(255,107,107,0.3);
        }
        
        .business-primary-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            font-weight: 700;
        }
        
        .business-primary-btn:hover {
            background: linear-gradient(135deg, #FFA500, #FFD700);
            box-shadow: 0 6px 20px rgba(255,215,0,0.4);
        }
        
        .business-benefits {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .business-benefits h4 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .business-benefits ul {
            list-style: none;
            padding: 0;
        }
        
        .business-benefits li {
            padding: 5px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .auth-divider {
            text-align: center;
            margin: 30px 0;
            position: relative;
            color: var(--text-secondary);
        }
        
        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255,255,255,0.2);
        }
        
        .auth-divider span {
            background: var(--bg-dark);
            padding: 0 15px;
            position: relative;
        }
        
        .auth-switch {
            text-align: center;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .auth-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        /* ===== LOADING & EMPTY STATES ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 400;
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.8;
        }
        
        .empty-state h3 {
            font-size: 20px;
            margin: 20px 0 10px;
        }
        
        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        .empty-state .auth-btn {
            display: inline-block;
            padding: 12px 30px;
            margin-top: 10px;
        }
        
        /* ===== SETTINGS MENU ===== */
        .settings-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-content {
            background: #2a2a2a;
            border-radius: 20px;
            padding: 30px;
            max-width: 300px;
            width: 90%;
            border: 1px solid var(--border-color);
            animation: popIn 0.3s ease;
        }
        
        .settings-content h3 {
            margin: 0 0 20px 0;
            text-align: center;
            color: var(--primary-color);
        }
        
        .settings-options button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .settings-options button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .settings-options .logout-btn {
            background: rgba(255,107,107,0.2);
            border-color: rgba(255,107,107,0.3);
            color: var(--danger-color);
        }
        
        .settings-options .logout-btn:hover {
            background: rgba(255,107,107,0.3);
        }
        
        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }
        
        .no-scroll {
            overflow: hidden;
        }
        
        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 375px) {
            .header-title {
                font-size: 16px;
            }
            
            .user-name {
                font-size: 24px;
            }
            
            .social-tab {
                font-size: 13px;
                padding: 10px;
            }
            
            .nav-label {
                font-size: 9px;
            }
        }
        
        @media (min-width: 1024px) {
            .user-feed-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .user-feed-item {
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Screens Container -->
        <div class="main-screens">
            <!-- Restaurant Feed Screen -->
            <div id="restaurantScreen" class="screen active">
                <div class="header">
                    <button class="back-btn" aria-label="Go back">‚Üê</button>
                    <div class="header-title">Hungry?</div>
                    <button class="settings-btn" onclick="CLASSIFIED.openSettings()" aria-label="Settings">‚öôÔ∏è</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Find Restaurant..." aria-label="Search restaurants">
                    <button class="filter-btn">üîΩ Filter by preferences</button>
                </div>
                <div class="stories-section">
                    <div class="stories-title">DAILY STORIES</div>
                    <div class="stories-scroll" id="restaurantStories">
                        <!-- Stories populated by JavaScript -->
                    </div>
                </div>
                <div class="feed-container">
                    <div class="feed-header">
                        <h3>FEATURED</h3>
                    </div>
                    <div id="restaurantFeed" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <!-- Social Screen -->
            <div id="socialScreen" class="screen">
                <div class="header">
                    <button class="back-btn" aria-label="Go back">‚Üê</button>
                    <div class="header-title">Feeling Adventurous?!</div>
                    <div class="match-badge" id="socialHeaderBadge">83% Match</div>
                </div>
                <div class="social-tabs">
                    <div class="social-tab active" data-tab="userFeed">üë• Browse People</div>
                    <div class="social-tab" data-tab="messaging">üí¨ Messaging</div>
                </div>
                
                <!-- User Feed Content -->
                <div id="userFeedContent" class="social-content active">
                    <div class="filter-options">
                        <div class="filter-chip active" data-filter="all">All</div>
                        <div class="filter-chip" data-filter="online">üü¢ Online Now</div>
                        <div class="filter-chip" data-filter="nearby">üìç Nearby</div>
                        <div class="filter-chip" data-filter="nomads">üíª Digital Nomads</div>
                    </div>
                    <div class="user-feed-container" id="userFeedContainer">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Messaging Content -->
                <div id="messagingContent" class="social-content">
                    <div class="messaging-container">
                        <div class="matches-section">
                            <div class="matches-title">New Matches</div>
                            <div class="matches-scroll" id="matchesScroll">
                                <!-- Match avatars populated by JavaScript -->
                            </div>
                        </div>
                        <div class="chat-list" id="chatList">
                            <!-- Chat items populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Activity Feed Screen -->
            <div id="activityScreen" class="screen">
                <div class="header">
                    <button class="back-btn" aria-label="Go back">‚Üê</button>
                    <div class="header-title">Feeling Adventurous?!</div>
                    <button class="settings-btn" onclick="CLASSIFIED.openSettings()" aria-label="Settings">‚öôÔ∏è</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Find Activity..." aria-label="Search activities">
                    <button class="filter-btn">üîΩ Filter by preferences</button>
                </div>
                <div class="stories-section">
                    <div class="stories-title">DAILY STORIES</div>
                    <div class="stories-scroll" id="activityStories">
                        <!-- Stories populated by JavaScript -->
                    </div>
                </div>
                <div class="feed-container">
                    <div class="feed-header">
                        <h3>FEATURED</h3>
                    </div>
                    <div id="activityFeed" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Editor Overlay -->
        <div id="profileEditor" class="overlay-screen">
            <div class="header">
                <button class="back-btn" aria-label="Close profile editor">‚Üê</button>
                <div class="header-title">Edit Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.viewMyProfile()" aria-label="View profile">üë§</button>
            </div>
            <div class="profile-editor">
                <!-- Profile Photos Section -->
                <div class="profile-section">
                    <div class="section-title">Profile Photos</div>
                    <input type="file" id="photoUploadInput" accept="image/*" style="display: none;" onchange="if(window.CLASSIFIED) CLASSIFIED.handlePhotoUpload(event)">
                    <div class="photo-upload-section" onclick="document.getElementById('photoUploadInput').click()">
                        <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">üì∑</div>
                        <div style="font-weight: 600;">Add Your Best Photos</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Tap to add photos</div>
                    </div>
                    <div class="photo-grid" id="photoGrid">
                        <div class="photo-slot" data-slot="0">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                            <button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) CLASSIFIED.removePhoto(0)">√ó</button>
                        </div>
                        <div class="photo-slot" data-slot="1">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                            <button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) CLASSIFIED.removePhoto(1)">√ó</button>
                        </div>
                        <div class="photo-slot" data-slot="2">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                            <button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) CLASSIFIED.removePhoto(2)">√ó</button>
                        </div>
                        <div class="photo-slot" data-slot="3">
                            <span style="font-size: 24px; opacity: 0.5;">+</span>
                            <button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) CLASSIFIED.removePhoto(3)">√ó</button>
                        </div>
                    </div>
                </div>
                
                <!-- About Me Section -->
                <div class="profile-section">
                    <div class="section-title">About Me</div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-input form-textarea" id="profileBio" placeholder="Write about yourself or something you're up to..."></textarea>
                        <span class="error-message" id="bioError"></span>
                    </div>
                </div>
                
                <!-- Basic Info Section -->
                <div class="profile-section">
                    <div class="section-title">Basic Info</div>
                    
                    <div class="form-group">
                        <label class="form-label">Birthday</label>
                        <input type="date" class="form-input" id="profileBirthday">
                        <span class="error-message" id="birthdayError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Zodiac Sign</label>
                        <div class="choice-group">
                            <div class="choice-btn" data-choice="zodiac" data-value="Aries">‚ôà Aries</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Taurus">‚ôâ Taurus</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Gemini">‚ôä Gemini</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Cancer">‚ôã Cancer</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Leo">‚ôå Leo</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Virgo">‚ôç Virgo</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Libra">‚ôé Libra</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Scorpio">‚ôè Scorpio</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Sagittarius">‚ôê Sagittarius</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Capricorn">‚ôë Capricorn</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Aquarius">‚ôí Aquarius</div>
                            <div class="choice-btn" data-choice="zodiac" data-value="Pisces">‚ôì Pisces</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Height</label>
                        <input type="text" class="form-input" id="profileHeight" placeholder="5'7&quot; or 170cm">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Career</label>
                        <div class="choice-group">
                            <div class="choice-btn" data-choice="career" data-value="Student">Student</div>
                            <div class="choice-btn" data-choice="career" data-value="Digital Nomad">Digital Nomad</div>
                            <div class="choice-btn" data-choice="career" data-value="Teacher">Teacher</div>
                            <div class="choice-btn" data-choice="career" data-value="Nurse">Nurse</div>
                            <div class="choice-btn" data-choice="career" data-value="Engineer">Engineer</div>
                            <div class="choice-btn" data-choice="career" data-value="Artist">Artist</div>
                            <div class="choice-btn" data-choice="career" data-value="Business">Business</div>
                            <div class="choice-btn" data-choice="career" data-value="Other">Other</div>
                        </div>
                    </div>
                </div>
                
                <!-- Interests Section -->
                <div class="profile-section">
                    <div class="section-title">What Am I Like</div>
                    <div class="interests-grid">
                        <div class="interest-btn" data-interest="Adventure">Adventure</div>
                        <div class="interest-btn" data-interest="Reading">Reading</div>
                        <div class="interest-btn" data-interest="Sports">Sports</div>
                        <div class="interest-btn" data-interest="Music">Music</div>
                        <div class="interest-btn" data-interest="Travel">Travel</div>
                        <div class="interest-btn" data-interest="Food">Food</div>
                        <div class="interest-btn" data-interest="Art">Art</div>
                        <div class="interest-btn" data-interest="Fitness">Fitness</div>
                        <div class="interest-btn" data-interest="Photography">Photography</div>
                        <div class="interest-btn" data-interest="Cooking">Cooking</div>
                        <div class="interest-btn" data-interest="Dancing">Dancing</div>
                        <div class="interest-btn" data-interest="Gaming">Gaming</div>
                    </div>
                </div>
                
                <!-- Preferences Section -->
                <div class="profile-section">
                    <div class="section-title">What Do I Like Most</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="priority" data-value="Travel">Travel</div>
                        <div class="choice-btn" data-choice="priority" data-value="Friends">Friends</div>
                        <div class="choice-btn" data-choice="priority" data-value="Family">Family</div>
                        <div class="choice-btn" data-choice="priority" data-value="Career">Career</div>
                    </div>
                </div>
                
                <!-- Relationship Section -->
                <div class="profile-section">
                    <div class="section-title">Relationship Status</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="relationship" data-value="Single">Single</div>
                        <div class="choice-btn" data-choice="relationship" data-value="In a Relationship">In a Relationship</div>
                        <div class="choice-btn" data-choice="relationship" data-value="Common Law w. Children">Common Law w. Children</div>
                        <div class="choice-btn" data-choice="relationship" data-value="It's Complicated">It's Complicated</div>
                    </div>
                </div>
                
                <!-- Looking For Section -->
                <div class="profile-section">
                    <div class="section-title">What Am I Looking For</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="lookingFor" data-value="Friends">Friends</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Dating">Dating</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Networking">Networking</div>
                        <div class="choice-btn" data-choice="lookingFor" data-value="Adventure Buddies">Adventure Buddies</div>
                    </div>
                </div>
                
                <!-- Marriage Thoughts Section -->
                <div class="profile-section">
                    <div class="section-title">Thoughts about Marriage</div>
                    <div class="choice-group">
                        <div class="choice-btn" data-choice="marriage" data-value="Wants One Day">üíç Wants One Day</div>
                        <div class="choice-btn" data-choice="marriage" data-value="Not Sure">ü§∑ Not Sure</div>
                        <div class="choice-btn" data-choice="marriage" data-value="Not Interested">‚ùå Not Interested</div>
                    </div>
                </div>
                
                <button class="save-profile-btn" id="saveProfileBtn" onclick="if(window.CLASSIFIED) window.CLASSIFIED.saveUserProfile()">Save Profile</button>
            </div>
        </div>
        
        <!-- User Profile View Overlay -->
        <div id="userProfileView" class="overlay-screen">
            <div class="header">
                <button class="back-btn" aria-label="Close profile">‚Üê</button>
                <div class="header-title" id="userProfileTitle">Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.startChatWithViewedUser()" aria-label="Start chat">üí¨</button>
            </div>
            <div class="profile-hero" id="userProfileHero">
                <div class="profile-overlay">
                    <div class="profile-name" id="userProfileName">Loading...</div>
                    <div class="profile-type" id="userProfileAge">Loading...</div>
                    <div class="profile-rating">
                        <div class="stars" style="color: #00D4FF;">üî•üî•üî•</div>
                        <span id="userProfileMatch">85% Match</span>
                    </div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-title">About</div>
                    <div class="profile-description" id="userProfileBio">
                        Loading user bio...
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">üìç Distance</div>
                            <div class="detail-value" id="userProfileDistance">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üü¢ Status</div>
                            <div class="detail-value" id="userProfileStatus">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìä Category</div>
                            <div class="detail-value" id="userProfileCategory">-</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Interests</div>
                    <div class="user-interests" id="userProfileInterests">
                        <!-- Interests populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.handleUserAction('pass')">‚úï Pass</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.handleUserAction('like')">üí¨ Like</button>
            </div>
        </div>
        
        <!-- My Profile View Overlay -->
        <div id="myProfileView" class="overlay-screen">
            <div class="header">
                <button class="back-btn" aria-label="Close my profile">‚Üê</button>
                <div class="header-title">My Profile</div>
                <button class="settings-btn" onclick="CLASSIFIED.openProfileEditor()" aria-label="Edit profile">‚úèÔ∏è</button>
            </div>
            <div class="profile-hero" id="myProfileHero" style="background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop')">
                <div class="profile-overlay">
                    <div class="profile-name" id="myProfileName">Your Name</div>
                    <div class="profile-type" id="myProfileAge">Age</div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-title">About Me</div>
                    <div class="profile-description" id="myProfileBio">
                        Complete your profile to start connecting with amazing people in Hoi An!
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">üéÇ Age</div>
                            <div class="detail-value" id="myProfileAgeDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìè Height</div>
                            <div class="detail-value" id="myProfileHeightDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üíº Career</div>
                            <div class="detail-value" id="myProfileCareerDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">‚≠ê Zodiac</div>
                            <div class="detail-value" id="myProfileZodiacDetail">-</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üíù Looking For</div>
                            <div class="detail-value" id="myProfileLookingForDetail">-</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">My Interests</div>
                    <div class="user-interests" id="myProfileInterests">
                        <!-- Interests populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.shareMyProfile()">Share Profile</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.openProfileEditor()">Edit Profile</button>
            </div>
        </div>
        
        <!-- Business Profile Overlay -->
        <div id="businessProfile" class="overlay-screen">
            <div class="header">
                <button class="back-btn" id="profileBackBtn" aria-label="Close business profile">‚Üê</button>
                <div class="header-title" id="profileHeaderTitle">Business Profile</div>
                <button class="settings-btn" aria-label="Settings">‚öôÔ∏è</button>
            </div>
            <div class="profile-hero" id="profileHero">
                <div class="profile-overlay">
                    <div class="profile-name" id="profileName">Loading...</div>
                    <div class="profile-type" id="profileType">Loading...</div>
                    <div class="profile-rating">
                        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <span>4.8 (124 reviews)</span>
                    </div>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-section">
                    <div class="current-promo">
                        <div class="promo-badge">üî• SPECIAL OFFER</div>
                        <div class="promo-title" id="profilePromoTitle">Loading...</div>
                        <div class="promo-details" id="profilePromoDetails">Loading...</div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">About</div>
                    <div class="profile-description" id="profileDescription">
                        A vibrant spot in the heart of Hoi An, perfect for backpackers and travelers.
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Details</div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">üìç Location</div>
                            <div class="detail-value" id="profileLocation">Hoi An Ancient Town</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üïí Hours</div>
                            <div class="detail-value" id="profileHours">5:00 PM - 2:00 AM</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üí∞ Price Range</div>
                            <div class="detail-value" id="profilePrice">$ - Moderate</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üì± Contact</div>
                            <div class="detail-value" id="profileContact">+84 123 456 789</div>
                        </div>
                    </div>
                </div>
                <div class="profile-section">
                    <div class="section-title">Popular With</div>
                    <div class="user-interests">
                        <span class="interest-tag">Backpackers</span>
                        <span class="interest-tag">Digital Nomads</span>
                        <span class="interest-tag">Expats</span>
                        <span class="interest-tag">Live Music Lovers</span>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-button secondary-btn" onclick="CLASSIFIED.shareBusinessProfile()">Share</button>
                <button class="action-button primary-btn" onclick="CLASSIFIED.getDirections()">Get Directions</button>
            </div>
        </div>
        
        <!-- Individual Chat Overlay -->
        <div id="individualChat" class="overlay-screen">
            <div class="chat-header">
                <button class="back-btn" id="chatBackBtn" aria-label="Close chat">‚Üê</button>
                <div class="chat-header-avatar" id="chatAvatar" onclick="CLASSIFIED.openProfileFromChat();"></div>
                <div class="chat-header-info" onclick="CLASSIFIED.openProfileFromChat();">
                    <div class="chat-header-name" id="chatName">Jessica</div>
                    <div class="chat-status">Online now</div>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div class="message-bubble">Hey! I saw you're into live music too üéµ</div>
                </div>
                <div class="message sent">
                    <div class="message-bubble">Yes! Love finding new venues. Any recommendations in Hoi An?</div>
                </div>
                <div class="message received">
                    <div class="message-bubble">Actually, I just got this promo for tonight!</div>
                </div>
                <div class="message received">
                    <div class="promo-message-card">
                        <div class="promo-title">üç∑ Date Night Special</div>
                        <div class="promo-details">2-for-1 Cocktails + Free Appetizer<br>Tonight 6-9pm<br>Banh Mi Queen</div>
                    </div>
                </div>
                <div class="message sent">
                    <div class="message-bubble">Perfect! Want to check it out together? üòä</div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type a message..." id="messageInput" aria-label="Type a message">
                <button class="send-btn" id="sendBtn" aria-label="Send message">‚û§</button>
            </div>
        </div>
        
        <!-- Match Popup -->
        <div id="matchPopup" class="match-popup">
            <div class="match-content">
                <div class="match-text">IT'S A MATCH! üéâ</div>
                <p>You and Jessica both liked each other</p>
                <button class="match-btn" id="startChatBtn">Start Chatting</button>
            </div>
        </div>
        
        <!-- Settings Menu -->
        <div id="settingsMenu" class="settings-menu hidden">
            <div class="settings-overlay" onclick="CLASSIFIED.closeSettings()">
                <div class="settings-content" onclick="event.stopPropagation()">
                    <h3>Settings</h3>
                    <div class="settings-options">
                        <button onclick="CLASSIFIED.openProfileEditor(); CLASSIFIED.closeSettings();">
                            <span>‚úèÔ∏è</span> Edit Profile
                        </button>
                        <button onclick="CLASSIFIED.viewMyProfile(); CLASSIFIED.closeSettings();">
                            <span>üë§</span> View My Profile
                        </button>
                        <button onclick="CLASSIFIED.openPrivacySettings(); CLASSIFIED.closeSettings();">
                            <span>üîí</span> Privacy Settings
                        </button>
                        <button onclick="CLASSIFIED.openNotificationSettings(); CLASSIFIED.closeSettings();">
                            <span>üîî</span> Notifications
                        </button>
                        <button class="logout-btn" onclick="CLASSIFIED.logout(); CLASSIFIED.closeSettings();">
                            <span>üö™</span> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        
        <!-- Login Screen -->
        <div id="loginScreen" class="auth-screen show">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Discover Hoi An's Hidden Gems</div>
            </div>
            <form class="auth-form" onsubmit="event.preventDefault(); CLASSIFIED.loginWithEmail();">
                <input type="email" class="auth-input" id="loginEmail" placeholder="Email address" required aria-label="Email">
                <input type="password" class="auth-input" id="loginPassword" placeholder="Password" required aria-label="Password">
                <button type="submit" class="auth-btn" id="loginBtn">Sign In</button>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button type="button" class="auth-btn google-btn" onclick="CLASSIFIED.loginWithGoogle()">
                    <span>üåü</span>
                    Continue with Google
                </button>
                
                <button type="button" class="auth-btn guest-btn" onclick="CLASSIFIED.browseAsGuest()">
                    <span>üëÄ</span>
                    Browse as Guest
                </button>
                
                <button type="button" class="auth-btn business-btn" onclick="CLASSIFIED.showBusinessLogin()">
                    <span>üíº</span>
                    Business Login
                </button>
            </form>
            <div class="auth-switch">
                Don't have an account? <a href="#" onclick="CLASSIFIED.showRegister()">Sign up</a>
            </div>
        </div>
        
        <!-- Registration Screen -->
        <div id="registerScreen" class="auth-screen">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Join the Hoi An Community</div>
            </div>
            <form class="auth-form" onsubmit="event.preventDefault(); CLASSIFIED.registerWithEmail();">
                <input type="text" class="auth-input" id="registerName" placeholder="Your name" required aria-label="Name">
                <input type="email" class="auth-input" id="registerEmail" placeholder="Email address" required aria-label="Email">
                <input type="password" class="auth-input" id="registerPassword" placeholder="Create password" required aria-label="Password">
                <input type="password" class="auth-input" id="registerConfirmPassword" placeholder="Confirm password" required aria-label="Confirm password">
                <button type="submit" class="auth-btn" id="registerBtn">Create Account</button>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button type="button" class="auth-btn google-btn" onclick="CLASSIFIED.loginWithGoogle()">
                    <span>üåü</span>
                    Continue with Google
                </button>
                
                <button type="button" class="auth-btn business-btn" onclick="CLASSIFIED.showBusinessRegister()">
                    <span>üíº</span>
                    Register as Business
                </button>
            </form>
            <div class="auth-switch">
                Already have an account? <a href="#" onclick="CLASSIFIED.showLogin()">Sign in</a>
            </div>
        </div>
        
        <!-- Business Login Screen -->
        <div id="businessLoginScreen" class="auth-screen">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Business Portal</div>
            </div>
            <form class="auth-form" onsubmit="event.preventDefault(); CLASSIFIED.businessLogin();">
                <input type="email" class="auth-input" id="businessLoginEmail" placeholder="Business email" required aria-label="Business Email">
                <input type="password" class="auth-input" id="businessLoginPassword" placeholder="Password" required aria-label="Password">
                <button type="submit" class="auth-btn business-primary-btn" id="businessLoginBtn">Sign In to Business Account</button>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button type="button" class="auth-btn" onclick="CLASSIFIED.showBusinessRegister()">
                    Create Business Account
                </button>
            </form>
            <div class="auth-switch">
                Not a business? <a href="#" onclick="CLASSIFIED.showLogin()">User login</a>
            </div>
        </div>
        
        <!-- Business Registration Screen -->
        <div id="businessRegisterScreen" class="auth-screen">
            <div class="auth-header">
                <div class="auth-logo">CLASSIFIED</div>
                <div class="auth-tagline">Register Your Business</div>
            </div>
            <form class="auth-form" onsubmit="event.preventDefault(); CLASSIFIED.businessRegister();">
                <input type="text" class="auth-input" id="businessName" placeholder="Business name" required aria-label="Business Name">
                <select class="auth-input" id="businessType" required aria-label="Business Type">
                    <option value="">Select business type</option>
                    <option value="restaurant">Restaurant/Bar</option>
                    <option value="activity">Activity/Tour</option>
                    <option value="accommodation">Accommodation</option>
                    <option value="shop">Shop/Service</option>
                </select>
                <input type="email" class="auth-input" id="businessEmail" placeholder="Business email" required aria-label="Business Email">
                <input type="tel" class="auth-input" id="businessPhone" placeholder="Phone number" required aria-label="Phone">
                <input type="password" class="auth-input" id="businessPassword" placeholder="Create password" required aria-label="Password">
                <input type="password" class="auth-input" id="businessConfirmPassword" placeholder="Confirm password" required aria-label="Confirm Password">
                <button type="submit" class="auth-btn business-primary-btn" id="businessRegisterBtn">Create Business Account</button>
                
                <div class="business-benefits">
                    <h4>Business Benefits:</h4>
                    <ul>
                        <li>‚úì Manage your business profile</li>
                        <li>‚úì Create special promotions</li>
                        <li>‚úì Connect with travelers</li>
                        <li>‚úì Get customer insights</li>
                    </ul>
                </div>
            </form>
            <div class="auth-switch">
                Already have an account? <a href="#" onclick="CLASSIFIED.showBusinessLogin()">Business login</a>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-screen="restaurant">
                <div class="nav-icon">üèÉ</div>
                <div class="nav-label">Your Event</div>
            </div>
            <div class="nav-item" data-screen="social">
                <div class="nav-icon">üéÄ</div>
                <div class="nav-label">Your Social</div>
            </div>
            <div class="nav-item" data-screen="activity">
                <div class="nav-icon">üì¶</div>
                <div class="nav-label">Your Activity</div>
            </div>
        </div>
    </div>
    
    <script>
        // üéØ CLASSIFIED v6.0 - Refactored Version
        // Complete rewrite with better structure and error handling
        
        // Firebase Configuration (Move to environment variables in production)
        const firebaseConfig = {
            // IMPORTANT: In production, use environment variables or server-side config
            // These should NOT be exposed in client-side code
            apiKey: "AIzaSyB-zTm6JB4EkD_7Q9056K4UGbIPyHQL4S4",
            authDomain: "hoi-an-social-app.firebaseapp.com",
            databaseURL: "https://hoi-an-social-app-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hoi-an-social-app",
            storageBucket: "hoi-an-social-app.firebasestorage.app",
            messagingSenderId: "302219568692",
            appId: "1:302219568692:web:3edf7128342b74b1e0cc61",
            measurementId: "G-WX23VDV53B"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Initialize services
        window.auth = firebase.auth();
        window.db = firebase.firestore();
        window.storage = firebase.storage();
        
        // ===== CLASSIFIED APPLICATION =====
        const CLASSIFIED = {
            // App State Management
            state: {
                currentScreen: 'restaurant',
                currentSocialTab: 'userFeed',
                currentBusiness: null,
                currentViewedUser: null,
                currentChatUser: null,
                currentUser: null,
                isAuthenticated: false,
                isLoading: false,
                isGuest: false,
                userType: 'user', // 'user', 'business', or 'guest'
                userProfile: {
                    name: '',
                    age: '',
                    bio: '',
                    birthday: '',
                    zodiac: '',
                    height: '',
                    career: '',
                    interests: [],
                    priority: '',
                    relationship: '',
                    lookingFor: '',
                    marriage: '',
                    photos: []
                },
                businessProfile: {
                    businessName: '',
                    businessType: '',
                    email: '',
                    phone: '',
                    location: '',
                    description: '',
                    hours: '',
                    priceRange: '',
                    photos: []
                }
            },
            
            // App Data
            data: {
                users: [
                    {
                        name: "Jessica",
                        age: 28,
                        image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop",
                        interests: ["Reading", "Gym", "Music", "Laughter", "Cafe Connoisseur"],
                        bio: "Backpacker exploring Vietnam üáªüá≥ Looking for adventure buddies and great coffee spots!",
                        isOnline: true,
                        distance: "2 km",
                        matchPercentage: 83,
                        category: "nomads"
                    },
                    {
                        name: "Dave",
                        age: 32,
                        image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop",
                        interests: ["Surfing", "Photography", "Coffee", "Adventure Sports", "Live Music"],
                        bio: "Digital nomad loving Hoi An vibes ‚ú® Always down for beach days and exploring local culture.",
                        isOnline: false,
                        distance: "1.5 km",
                        matchPercentage: 76,
                        category: "nomads"
                    },
                    {
                        name: "Rebecca",
                        age: 26,
                        image: "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=400&h=600&fit=crop",
                        interests: ["Yoga", "Cooking", "Beach", "Art", "Nightlife"],
                        bio: "Artist seeking creative adventures üé® Love painting landscapes and meeting fellow creatives!",
                        isOnline: true,
                        distance: "800m",
                        matchPercentage: 91,
                        category: "all"
                    },
                    {
                        name: "Alex",
                        age: 29,
                        image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=600&fit=crop",
                        interests: ["Hiking", "Beer", "Football", "Travel", "Food"],
                        bio: "Exploring Southeast Asia one city at a time üåè Football fanatic and craft beer enthusiast.",
                        isOnline: true,
                        distance: "3.2 km",
                        matchPercentage: 68,
                        category: "all"
                    },
                    {
                        name: "Maria",
                        age: 24,
                        image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop",
                        interests: ["Dancing", "Food", "Travel", "Photography", "Beach"],
                        bio: "Spanish girl making memories in Vietnam üíÉ Love salsa dancing and trying street food!",
                        isOnline: false,
                        distance: "4.1 km",
                        matchPercentage: 79,
                        category: "all"
                    },
                    {
                        name: "James",
                        age: 30,
                        image: "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?w=400&h=600&fit=crop",
                        interests: ["Music", "Art", "Coffee", "Culture", "Adventure"],
                        bio: "British musician discovering Southeast Asia üé∏ Looking for jam sessions and cultural experiences.",
                        isOnline: true,
                        distance: "1.8 km",
                        matchPercentage: 85,
                        category: "nomads"
                    }
                ],
                
                restaurants: [
                    {
                        id: 'banh-mi-queen',
                        name: "Banh Mi Queen",
                        type: "Vietnamese Street Food",
                        image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1551218808-94e220e084d2?w=150&h=200&fit=crop",
                        promo: "2-for-1 Banh Mi Special",
                        details: "Daily 7am-10pm ‚Ä¢ Perfect for breakfast",
                        description: "Authentic Vietnamese banh mi served fresh daily. A favorite among backpackers for quick, delicious, and affordable meals in the heart of Hoi An Ancient Town.",
                        location: "123 Tran Phu Street, Hoi An",
                        hours: "7:00 AM - 10:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 123 456"
                    },
                    {
                        id: 'thuan-tinh-island-bar',
                        name: "Thuan Tinh Island Bar",
                        type: "Riverside Bar & Grill",
                        image: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=150&h=200&fit=crop",
                        promo: "Happy Hour - 50% Off All Drinks",
                        details: "Daily 4pm-2am ‚Ä¢ River views & live music",
                        description: "Stunning riverside location with panoramic views of Thu Bon River. Popular with expats and travelers for sunset drinks, live music, and BBQ nights.",
                        location: "Thuan Tinh Island, Hoi An",
                        hours: "4:00 PM - 2:00 AM",
                        price: "$ - Moderate",
                        contact: "+84 235 234 567"
                    },
                    {
                        id: 'streets-restaurant',
                        name: "Streets Restaurant & Cafe",
                        type: "International Cuisine",
                        image: "https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=150&h=200&fit=crop",
                        promo: "Western Breakfast Special",
                        details: "Daily 7am-11pm ‚Ä¢ WiFi & AC",
                        description: "Western and Vietnamese fusion cuisine in a comfortable, air-conditioned setting. Great for digital nomads with reliable WiFi and international menu options.",
                        location: "45 Le Loi Street, Hoi An",
                        hours: "7:00 AM - 11:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 345 678"
                    },
                    {
                        id: 'moon-sports-bar',
                        name: "Moon Sports Bar",
                        type: "Sports Bar & Nightlife",
                        image: "https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1574391884720-bbc273b7c282?w=150&h=200&fit=crop",
                        promo: "Game Night - Free Pool & Darts",
                        details: "Daily 5pm-late ‚Ä¢ Live sports & games",
                        description: "The go-to spot for sports lovers and night owls. Multiple screens showing international sports, pool tables, and a lively atmosphere perfect for meeting fellow travelers.",
                        location: "67 Nguyen Thai Hoc, Hoi An",
                        hours: "5:00 PM - 2:00 AM",
                        price: "$ - Moderate",
                        contact: "+84 235 456 789"
                    },
                    {
                        id: 'lantern-town-coffee',
                        name: "Lantern Town Coffee",
                        type: "Coffee Shop & Co-working",
                        image: "https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=150&h=200&fit=crop",
                        promo: "Digital Nomad Deal - Coffee + WiFi",
                        details: "Daily 6am-10pm ‚Ä¢ Perfect for remote work",
                        description: "Specialty coffee roasted locally with fast WiFi and comfortable workspaces. The perfect spot for digital nomads and remote workers exploring Hoi An.",
                        location: "12 Bach Dang Street, Hoi An",
                        hours: "6:00 AM - 10:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 567 890"
                    },
                    {
                        id: 'cham-chi',
                        name: "Cham Chi",
                        type: "Restaurant & Bar",
                        image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?w=150&h=200&fit=crop",
                        promo: "Jam Night - Buy One Get 2 Cocktails",
                        details: "Every Wednesday ‚Ä¢ Open Mic Night",
                        description: "Hoi An's premier nightlife destination. Three floors of music, rooftop bar with ancient town views.",
                        location: "89 Nguyen Phuc Chu, Hoi An",
                        hours: "10:00 AM - 11:00 PM",
                        price: "$$ - Moderate to High",
                        contact: "+84 235 999 888"
                    },
                    {
                        id: '8-days-a-week',
                        name: "8 Days A Week",
                        type: "Restaurant & Bar",
                        image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?w=150&h=200&fit=crop",
                        promo: "Sunset Special - 30% Off All Cocktails",
                        details: "Jam Night Every Monday ‚Ä¢ Delicious cocktails close to the beach",
                        description: "Creative fusion cuisine blending Vietnamese and international flavors. Famous for innovative cocktails.",
                        location: "45 Nguyen Phuc Tan, Hoi An",
                        hours: "11:00 AM - 11:00 PM",
                        price: "$$ - Moderate",
                        contact: "+84 235 678 345"
                    }
                ],
                
                activities: [
                    {
                        id: 'basket-boat-tours',
                        name: "Basket Boat Adventure",
                        type: "Water Sports",
                        image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=150&h=200&fit=crop",
                        promo: "Group Discount - 4+ People Save 30%",
                        details: "Daily tours 8am & 2pm ‚Ä¢ 3 hours duration",
                        description: "Traditional Vietnamese basket boat tours through coconut forests. Perfect group activity for backpackers wanting to experience local culture and nature.",
                        location: "Coconut Forest, Cam Thanh",
                        hours: "8:00 AM - 5:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 678 901"
                    },
                    {
                        id: 'motorbike-adventures',
                        name: "Hoi An Motorbike Tours",
                        type: "Adventure Tours",
                        image: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?w=150&h=200&fit=crop",
                        promo: "Sunrise Tour Special - Early Bird 20% Off",
                        details: "Multiple daily tours ‚Ä¢ All skill levels",
                        description: "Explore the countryside around Hoi An on authentic Vietnamese motorbikes. Safe, guided tours perfect for adventurous travelers wanting to see the real Vietnam.",
                        location: "85 Cua Dai Street, Hoi An",
                        hours: "6:00 AM - 8:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 789 012"
                    },
                    {
                        id: 'lantern-making-class',
                        name: "Traditional Lantern Workshop",
                        type: "Cultural Experience",
                        image: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1544148103-0773bf10d330?w=150&h=200&fit=crop",
                        promo: "Couples Workshop - Make Lanterns Together",
                        details: "Daily classes 10am & 3pm ‚Ä¢ Take home your creation",
                        description: "Learn to make traditional Vietnamese lanterns from local artisans. A perfect cultural activity for travelers wanting to create something beautiful and meaningful.",
                        location: "Ancient Town Workshop District",
                        hours: "9:00 AM - 6:00 PM",
                        price: "$ - Budget Friendly",
                        contact: "+84 235 890 123"
                    },
                    {
                        id: 'cooking-school',
                        name: "Sabirama Cooking School",
                        type: "Culinary Experience",
                        image: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=150&h=200&fit=crop",
                        promo: "Full Day Class - Market Tour Included",
                        details: "Half & full day classes ‚Ä¢ Vegetarian options",
                        description: "Hands-on Vietnamese cooking classes including market tours. Learn to make pho, banh mi, and other local favorites in a fun, social environment.",
                        location: "Tra Que Vegetable Village",
                        hours: "8:00 AM - 4:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 901 234"
                    },
                    {
                        id: 'beach-club-an-bang',
                        name: "An Bang Beach Club",
                        type: "Beach & Water Sports",
                        image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=300&fit=crop",
                        logo: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=100&h=100&fit=crop",
                        story: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=150&h=200&fit=crop",
                        promo: "Beach Day Pass - Sunbed + Drink Included",
                        details: "Daily 8am-sunset ‚Ä¢ Surfboard rental available",
                        description: "Beautiful beach club on An Bang Beach with sunbeds, fresh seafood, and water sports. Perfect for beach lovers and surfers looking to relax and socialize.",
                        location: "An Bang Beach, Hoi An",
                        hours: "8:00 AM - 7:00 PM",
                        price: "$ - Moderate",
                        contact: "+84 235 012 345"
                    }
                ],
                
                chats: [
                    {
                        name: "Jessica",
                        message: "Perfect! Want to check it out together? üòä",
                        time: "2m",
                        avatar: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop"
                    },
                    {
                        name: "Dave",
                        message: "Great surfing spots near Da Nang!",
                        time: "1h",
                        avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop"
                    },
                    {
                        name: "Rebecca",
                        message: "The art scene here is amazing!",
                        time: "3h",
                        avatar: "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?w=100&h=100&fit=crop"
                    }
                ]
            },
            
            // ===== INITIALIZATION =====
            init() {
                this.setupAuthListener();
                this.setupEventListeners();
                this.populateFeeds();
                this.setupProfileEditor();
                this.addImageErrorHandlers();
                
                // Check if browsing as guest (this would be set elsewhere, e.g., from URL params)
                if (this.state.isGuest) {
                    this.populateGuestUserFeed();
                    this.populateMessaging();
                }
            },
            
            // ===== AUTHENTICATION METHODS =====
            setupAuthListener() {
                window.auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        this.state.currentUser = user;
                        this.state.isAuthenticated = true;
                        this.state.isGuest = false; // Clear guest mode when authenticated
                        
                        // Check if it's a business account
                        try {
                            const userDoc = await window.db.collection('users').doc(user.uid).get();
                            if (userDoc.exists) {
                                const userData = userDoc.data();
                                this.state.userType = userData.userType || 'user';
                                
                                if (this.state.userType === 'business') {
                                    this.state.businessProfile = { ...this.state.businessProfile, ...userData };
                                } else {
                                    this.state.userProfile = { ...this.state.userProfile, ...userData };
                                }
                            }
                        } catch (error) {
                            console.error('Error checking user type:', error);
                        }
                        
                        this.hideAuthScreens();
                        this.loadUserProfile(user.uid);
                        this.populateUserFeed();
                        this.populateMessaging();
                        
                        // Show business dashboard if business account
                        if (this.state.userType === 'business') {
                            this.showBusinessDashboard();
                        }
                    } else if (!this.state.isGuest) {
                        // Only show login if not browsing as guest
                        this.state.currentUser = null;
                        this.state.isAuthenticated = false;
                        this.showLogin();
                    }
                });
            },
            
            async loginWithEmail() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    this.showError('Please enter email and password');
                    return;
                }
                
                const loginBtn = document.getElementById('loginBtn');
                loginBtn.disabled = true;
                
                try {
                    this.showLoading();
                    await window.auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    this.hideLoading();
                    loginBtn.disabled = false;
                    this.handleAuthError(error);
                }
            },
            
            async registerWithEmail() {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                
                // Validation
                if (!name || !email || !password || !confirmPassword) {
                    this.showError('Please fill in all fields');
                    return;
                }
                
                if (!this.validateEmail(email)) {
                    this.showError('Please enter a valid email address');
                    return;
                }
                
                if (password !== confirmPassword) {
                    this.showError('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('Password must be at least 6 characters');
                    return;
                }
                
                const registerBtn = document.getElementById('registerBtn');
                registerBtn.disabled = true;
                
                try {
                    this.showLoading();
                    
                    const userCredential = await window.auth.createUserWithEmailAndPassword(email, password);
                    
                    await userCredential.user.updateProfile({
                        displayName: name
                    });
                    
                    await this.createUserProfile(userCredential.user.uid, {
                        name: name,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        location: 'Hoi An, Vietnam'
                    });
                    
                } catch (error) {
                    this.hideLoading();
                    registerBtn.disabled = false;
                    this.handleAuthError(error);
                }
            },
            
            async loginWithGoogle() {
                try {
                    this.showLoading();
                    const provider = new firebase.auth.GoogleAuthProvider();
                    const result = await window.auth.signInWithPopup(provider);
                    
                    const userDoc = await window.db.collection('users').doc(result.user.uid).get();
                    
                    if (!userDoc.exists) {
                        await this.createUserProfile(result.user.uid, {
                            name: result.user.displayName,
                            email: result.user.email,
                            photo: result.user.photoURL,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            location: 'Hoi An, Vietnam'
                        });
                    }
                } catch (error) {
                    this.hideLoading();
                    if (error.code !== 'auth/popup-closed-by-user') {
                        this.handleAuthError(error);
                    }
                }
            },
            
            async logout() {
                try {
                    await window.auth.signOut();
                    this.state.isGuest = false;
                    this.state.userType = 'user';
                    
                    // Reset header badge
                    const socialBadge = document.getElementById('socialHeaderBadge');
                    if (socialBadge) {
                        socialBadge.textContent = '83% Match';
                        socialBadge.className = 'match-badge';
                    }
                } catch (error) {
                    this.showError('Error logging out. Please try again.');
                }
            },
            
            // ===== GUEST BROWSING =====
            browseAsGuest() {
                this.state.isGuest = true;
                this.state.isAuthenticated = false;
                this.state.userType = 'guest';
                this.hideAuthScreens();
                this.showSuccess('Browsing as guest. Some features may be limited.');
                
                // Update header badge to show guest mode
                const socialBadge = document.getElementById('socialHeaderBadge');
                if (socialBadge) {
                    socialBadge.textContent = 'üëÄ Guest Mode';
                    socialBadge.className = 'match-badge guest-mode';
                }
                
                // Show limited functionality
                this.populateFeeds();
                this.populateGuestUserFeed();
                this.populateMessaging();
            },
            
            // ===== BUSINESS AUTHENTICATION =====
            showBusinessLogin() {
                document.getElementById('loginScreen').classList.remove('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.getElementById('businessLoginScreen').classList.add('show');
                document.getElementById('businessRegisterScreen').classList.remove('show');
            },
            
            showBusinessRegister() {
                document.getElementById('loginScreen').classList.remove('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.getElementById('businessLoginScreen').classList.remove('show');
                document.getElementById('businessRegisterScreen').classList.add('show');
            },
            
            async businessLogin() {
                const email = document.getElementById('businessLoginEmail').value;
                const password = document.getElementById('businessLoginPassword').value;
                
                if (!email || !password) {
                    this.showError('Please enter email and password');
                    return;
                }
                
                const loginBtn = document.getElementById('businessLoginBtn');
                loginBtn.disabled = true;
                
                try {
                    this.showLoading();
                    
                    // Sign in with Firebase
                    const userCredential = await window.auth.signInWithEmailAndPassword(email, password);
                    
                    // Verify it's a business account
                    const userDoc = await window.db.collection('users').doc(userCredential.user.uid).get();
                    if (userDoc.exists && userDoc.data().userType === 'business') {
                        this.state.userType = 'business';
                        this.showSuccess('Welcome back to your business dashboard!');
                    } else {
                        // Not a business account, sign them out
                        await window.auth.signOut();
                        throw new Error('This is not a business account. Please use regular login.');
                    }
                } catch (error) {
                    this.hideLoading();
                    loginBtn.disabled = false;
                    
                    if (error.message.includes('not a business account')) {
                        this.showError(error.message);
                    } else {
                        this.handleAuthError(error);
                    }
                }
            },
            
            async businessRegister() {
                const businessName = document.getElementById('businessName').value;
                const businessType = document.getElementById('businessType').value;
                const email = document.getElementById('businessEmail').value;
                const phone = document.getElementById('businessPhone').value;
                const password = document.getElementById('businessPassword').value;
                const confirmPassword = document.getElementById('businessConfirmPassword').value;
                
                // Validation
                if (!businessName || !businessType || !email || !phone || !password || !confirmPassword) {
                    this.showError('Please fill in all fields');
                    return;
                }
                
                if (!this.validateEmail(email)) {
                    this.showError('Please enter a valid email address');
                    return;
                }
                
                if (password !== confirmPassword) {
                    this.showError('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('Password must be at least 6 characters');
                    return;
                }
                
                const registerBtn = document.getElementById('businessRegisterBtn');
                registerBtn.disabled = true;
                
                try {
                    this.showLoading();
                    
                    // Create Firebase auth account
                    const userCredential = await window.auth.createUserWithEmailAndPassword(email, password);
                    
                    // Create business profile in Firestore
                    await window.db.collection('users').doc(userCredential.user.uid).set({
                        userType: 'business',
                        businessName: businessName,
                        businessType: businessType,
                        email: email,
                        phone: phone,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        location: 'Hoi An, Vietnam',
                        verified: false,
                        uid: userCredential.user.uid
                    });
                    
                    // Create entry in businesses collection
                    await window.db.collection('businesses').doc(userCredential.user.uid).set({
                        name: businessName,
                        type: businessType,
                        email: email,
                        phone: phone,
                        ownerId: userCredential.user.uid,
                        active: true,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    this.state.userType = 'business';
                    this.showSuccess('Business account created successfully! üéâ');
                    
                } catch (error) {
                    this.hideLoading();
                    registerBtn.disabled = false;
                    this.handleAuthError(error);
                }
            },
            
            showBusinessDashboard() {
                // TODO: Implement business dashboard
                this.showSuccess('Business dashboard coming soon! For now, you can browse the app.');
            },
            
            handleAuthError(error) {
                const errorMessages = {
                    'auth/network-request-failed': 'Network error. Please check your connection.',
                    'auth/user-not-found': 'User not found. Please sign up.',
                    'auth/wrong-password': 'Incorrect password. Please try again.',
                    'auth/email-already-in-use': 'Email already registered. Please sign in.',
                    'auth/weak-password': 'Password should be at least 6 characters.',
                    'auth/invalid-email': 'Please enter a valid email address.',
                    'auth/too-many-requests': 'Too many attempts. Please try again later.'
                };
                
                const message = errorMessages[error.code] || 'An error occurred. Please try again.';
                this.showError(message);
            },
            
            // ===== FIRESTORE METHODS =====
            async createUserProfile(uid, profileData) {
                try {
                    await window.db.collection('users').doc(uid).set({
                        ...profileData,
                        uid: uid
                    });
                } catch (error) {
                    throw error;
                }
            },
            
            async loadUserProfile(uid) {
                try {
                    const doc = await window.db.collection('users').doc(uid).get();
                    if (doc.exists) {
                        const userData = doc.data();
                        this.state.userProfile = { ...this.state.userProfile, ...userData };
                        if (userData.photos && userData.photos.length > 0) {
                            this.displayUserPhotos();
                        }
                    }
                } catch (error) {
                    console.error('Error loading user profile:', error);
                }
            },
            
            async saveUserProfile() {
                if (!this.state.currentUser) return;
                
                const saveBtn = document.getElementById('saveProfileBtn');
                saveBtn.disabled = true;
                
                try {
                    // Gather form data
                    this.state.userProfile.bio = document.getElementById('profileBio').value;
                    this.state.userProfile.birthday = document.getElementById('profileBirthday').value;
                    this.state.userProfile.height = document.getElementById('profileHeight').value;
                    
                    // Calculate age
                    if (this.state.userProfile.birthday) {
                        const today = new Date();
                        const birthDate = new Date(this.state.userProfile.birthday);
                        let age = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }
                        this.state.userProfile.age = age;
                    }
                    
                    // Save to Firebase
                    await window.db.collection('users').doc(this.state.currentUser.uid).update({
                        ...this.state.userProfile,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    this.showSuccess('Profile saved successfully! üéâ');
                    this.closeProfileEditor();
                    setTimeout(() => this.viewMyProfile(), 300);
                } catch (error) {
                    this.showError('Error saving profile. Please try again.');
                } finally {
                    saveBtn.disabled = false;
                }
            },
            
            // ===== UI METHODS =====
            showLogin() {
                document.getElementById('loginScreen').classList.add('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.getElementById('businessLoginScreen').classList.remove('show');
                document.getElementById('businessRegisterScreen').classList.remove('show');
                document.querySelector('.main-screens').classList.remove('authenticated');
                document.querySelector('.bottom-nav').style.display = 'none';
            },
            
            showRegister() {
                document.getElementById('registerScreen').classList.add('show');
                document.getElementById('loginScreen').classList.remove('show');
                document.getElementById('businessLoginScreen').classList.remove('show');
                document.getElementById('businessRegisterScreen').classList.remove('show');
            },
            
            hideAuthScreens() {
                document.getElementById('loginScreen').classList.remove('show');
                document.getElementById('registerScreen').classList.remove('show');
                document.getElementById('businessLoginScreen').classList.remove('show');
                document.getElementById('businessRegisterScreen').classList.remove('show');
                document.querySelector('.main-screens').classList.add('authenticated');
                document.querySelector('.bottom-nav').style.display = 'flex';
                this.hideLoading();
                
                // Reset header badge if not guest
                if (!this.state.isGuest) {
                    const socialBadge = document.getElementById('socialHeaderBadge');
                    if (socialBadge) {
                        if (this.state.userType === 'business') {
                            socialBadge.textContent = 'üíº Business';
                            socialBadge.className = 'match-badge business-mode';
                        } else {
                            socialBadge.textContent = '83% Match';
                            socialBadge.className = 'match-badge';
                        }
                    }
                }
            },
            
            showLoading() {
                document.getElementById('loadingOverlay').classList.add('show');
            },
            
            hideLoading() {
                document.getElementById('loadingOverlay').classList.remove('show');
            },
            
            showError(message) {
                // Create a better error notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--danger-color);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 1000;
                    animation: slideDown 0.3s ease;
                    max-width: 90%;
                    text-align: center;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            },
            
            showSuccess(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--success-color);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 1000;
                    animation: slideDown 0.3s ease;
                    max-width: 90%;
                    text-align: center;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            },
            
            // ===== EVENT LISTENERS =====
            setupEventListeners() {
                // Bottom navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const screen = item.dataset.screen;
                        this.showScreen(screen);
                    });
                });
                
                // Social tabs
                document.querySelectorAll('.social-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabType = tab.dataset.tab;
                        this.switchSocialTab(tabType);
                    });
                });
                
                // Filter chips
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        const filter = chip.dataset.filter;
                        this.filterUsers(filter);
                    });
                });
                
                // Back buttons for overlays
                document.querySelectorAll('.overlay-screen .back-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const overlay = btn.closest('.overlay-screen');
                        if (overlay) {
                            overlay.classList.remove('show');
                            this.updateOverlayState(overlay.id, false);
                        }
                    });
                });
                
                // Chat functionality
                document.getElementById('sendBtn').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                // Match popup
                document.getElementById('startChatBtn').addEventListener('click', () => this.startChatFromMatch());
                
                // Photo slots
                document.querySelectorAll('.photo-slot').forEach((slot, index) => {
                    slot.addEventListener('click', () => {
                        if (!slot.classList.contains('filled')) {
                            document.getElementById('photoUploadInput').dataset.targetSlot = index;
                            document.getElementById('photoUploadInput').click();
                        }
                    });
                });
            },
            
            updateOverlayState(overlayId, isOpen) {
                switch(overlayId) {
                    case 'profileEditor':
                        this.state.isProfileEditorOpen = isOpen;
                        break;
                    case 'userProfileView':
                        this.state.isUserProfileOpen = isOpen;
                        if (!isOpen) this.state.currentViewedUser = null;
                        break;
                    case 'businessProfile':
                        this.state.isProfileOpen = isOpen;
                        if (!isOpen) this.state.currentBusiness = null;
                        break;
                    case 'individualChat':
                        this.state.isChatOpen = isOpen;
                        if (!isOpen) this.state.currentChatUser = null;
                        break;
                    case 'myProfileView':
                        // No specific state for this
                        break;
                }
            },
            
            // ===== PROFILE EDITOR =====
            setupProfileEditor() {
                // Choice buttons
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const choiceType = btn.dataset.choice;
                        const value = btn.dataset.value;
                        this.selectChoice(choiceType, value, btn);
                    });
                });
                
                // Interest buttons
                document.querySelectorAll('.interest-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.toggleInterest(btn);
                    });
                });
            },
            
            openProfileEditor() {
                // Check if guest
                if (this.state.isGuest) {
                    this.showError('Please sign up to create your profile');
                    setTimeout(() => {
                        this.showRegister();
                    }, 1500);
                    return;
                }
                
                document.getElementById('profileEditor').classList.add('show');
                this.state.isProfileEditorOpen = true;
                this.loadProfileData();
            },
            
            closeProfileEditor() {
                document.getElementById('profileEditor').classList.remove('show');
                this.state.isProfileEditorOpen = false;
            },
            
            loadProfileData() {
                const profile = this.state.userProfile;
                
                // Load basic info
                document.getElementById('profileBio').value = profile.bio || '';
                document.getElementById('profileBirthday').value = profile.birthday || '';
                document.getElementById('profileHeight').value = profile.height || '';
                
                // Load choices
                Object.keys(profile).forEach(key => {
                    if (['zodiac', 'career', 'priority', 'relationship', 'lookingFor', 'marriage'].includes(key) && profile[key]) {
                        this.selectChoiceByValue(key, profile[key]);
                    }
                });
                
                // Load interests
                document.querySelectorAll('.interest-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (profile.interests.includes(btn.dataset.interest)) {
                        btn.classList.add('active');
                    }
                });
                
                // Load photos
                if (profile.photos && profile.photos.length > 0) {
                    this.displayUserPhotos();
                }
            },
            
            displayUserPhotos() {
                const photos = this.state.userProfile.photos;
                document.querySelectorAll('.photo-slot').forEach((slot, index) => {
                    if (photos[index]) {
                        slot.style.backgroundImage = `url('${photos[index]}')`;
                        slot.classList.add('filled');
                        slot.innerHTML = index === 0 ? 
                            '<div class="star-icon">‚≠ê</div><button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) window.CLASSIFIED.removePhoto(' + index + ')">√ó</button>' : 
                            '<button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) window.CLASSIFIED.removePhoto(' + index + ')">√ó</button>';
                    }
                });
            },
            
            selectChoice(choiceType, value, buttonElement) {
                // Remove active from siblings
                const siblings = buttonElement.parentElement.querySelectorAll('.choice-btn');
                siblings.forEach(btn => btn.classList.remove('active'));
                
                // Add active to clicked button
                buttonElement.classList.add('active');
                
                // Update state
                this.state.userProfile[choiceType] = value;
            },
            
            selectChoiceByValue(choiceType, value) {
                const btn = document.querySelector(`[data-choice="${choiceType}"][data-value="${value}"]`);
                if (btn) {
                    this.selectChoice(choiceType, value, btn);
                }
            },
            
            toggleInterest(buttonElement) {
                const interest = buttonElement.dataset.interest;
                const isActive = buttonElement.classList.contains('active');
                
                if (isActive) {
                    buttonElement.classList.remove('active');
                    this.state.userProfile.interests = this.state.userProfile.interests.filter(i => i !== interest);
                } else {
                    if (this.state.userProfile.interests.length < 8) {
                        buttonElement.classList.add('active');
                        this.state.userProfile.interests.push(interest);
                    } else {
                        this.showError('You can select up to 8 interests!');
                    }
                }
            },
            
            // ===== PHOTO UPLOAD =====
            async handlePhotoUpload(event) {
                const file = event.target.files[0];
                const targetSlot = parseInt(event.target.dataset.targetSlot || 0);
                
                if (!file) return;
                
                // Validation
                if (file.size > 5 * 1024 * 1024) {
                    this.showError('Photo must be less than 5MB');
                    return;
                }
                
                if (!file.type.match(/image\/(jpeg|jpg|png|gif)/)) {
                    this.showError('Please upload a valid image file');
                    return;
                }
                
                try {
                    this.showLoading();
                    
                    // Create a reference to the file location
                    const timestamp = Date.now();
                    const fileName = `profile_photos/${this.state.currentUser.uid}/${timestamp}_${file.name}`;
                    const storageRef = window.storage.ref(fileName);
                    
                    // Upload the file
                    const snapshot = await storageRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    // Update UI
                    const slot = document.querySelectorAll('.photo-slot')[targetSlot];
                    if (slot) {
                        slot.style.backgroundImage = `url('${downloadURL}')`;
                        slot.classList.add('filled');
                        slot.innerHTML = targetSlot === 0 ? 
                            '<div class="star-icon">‚≠ê</div><button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) window.CLASSIFIED.removePhoto(' + targetSlot + ')">√ó</button>' : 
                            '<button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) window.CLASSIFIED.removePhoto(' + targetSlot + ')">√ó</button>';
                    }
                    
                    // Update state
                    this.state.userProfile.photos[targetSlot] = downloadURL;
                    
                    this.hideLoading();
                    this.showSuccess('Photo uploaded successfully!');
                } catch (error) {
                    this.hideLoading();
                    this.showError('Failed to upload photo. Please try again.');
                }
            },
            
            async removePhoto(slotIndex) {
                if (confirm('Remove this photo?')) {
                    const slot = document.querySelectorAll('.photo-slot')[slotIndex];
                    if (slot) {
                        slot.style.backgroundImage = '';
                        slot.classList.remove('filled');
                        slot.innerHTML = '<span style="font-size: 24px; opacity: 0.5;">+</span><button class="remove-photo" onclick="event.stopPropagation(); if(window.CLASSIFIED) window.CLASSIFIED.removePhoto(' + slotIndex + ')">√ó</button>';
                        
                        // Remove from state
                        this.state.userProfile.photos[slotIndex] = null;
                    }
                }
            },
            
            // ===== SCREEN NAVIGATION =====
            showScreen(screenType) {
                this.state.currentScreen = screenType;
                
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Show target screen
                document.getElementById(`${screenType}Screen`).classList.add('active');
                
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-screen="${screenType}"]`).classList.add('active');
                
                // Reset social tab to userFeed when leaving social screen
                if (screenType !== 'social') {
                    this.switchSocialTab('userFeed');
                }
            },
            
            switchSocialTab(tabType) {
                // Check if guest trying to access messaging
                if (this.state.isGuest && tabType === 'messaging') {
                    this.showError('Please sign up to access messaging');
                    return;
                }
                
                this.state.currentSocialTab = tabType;
                
                // Update tabs
                document.querySelectorAll('.social-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');
                
                // Update content
                document.querySelectorAll('.social-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabType}Content`).classList.add('active');
            },
            
            // ===== FEED POPULATION =====
            populateFeeds() {
                this.populateRestaurantFeed();
                this.populateActivityFeed();
            },
            
            populateRestaurantFeed() {
                const storiesContainer = document.getElementById('restaurantStories');
                const feedContainer = document.getElementById('restaurantFeed');
                
                // Clear loading state
                feedContainer.classList.remove('loading');
                
                // Stories
                storiesContainer.innerHTML = this.data.restaurants.map(restaurant => 
                    `<div class="story-item" style="background-image: url('${restaurant.story}')">
                        <div class="story-overlay">
                            <div class="story-title">${restaurant.name}</div>
                            <div class="story-subtitle">${restaurant.type}</div>
                        </div>
                    </div>`
                ).join('');
                
                // Feed
                feedContainer.innerHTML = this.data.restaurants.map(restaurant => 
                    this.createBusinessCard(restaurant, 'restaurant')
                ).join('');
            },
            
            populateActivityFeed() {
                const storiesContainer = document.getElementById('activityStories');
                const feedContainer = document.getElementById('activityFeed');
                
                // Clear loading state
                feedContainer.classList.remove('loading');
                
                // Stories
                storiesContainer.innerHTML = this.data.activities.map(activity => 
                    `<div class="story-item" style="background-image: url('${activity.story}')">
                        <div class="story-overlay">
                            <div class="story-title">${activity.name}</div>
                            <div class="story-subtitle">${activity.type}</div>
                        </div>
                    </div>`
                ).join('');
                
                // Feed
                feedContainer.innerHTML = this.data.activities.map(activity => 
                    this.createBusinessCard(activity, 'activity')
                ).join('');
            },
            
            createBusinessCard(business, type) {
                return `
                    <div class="business-card" onclick="CLASSIFIED.openBusinessProfile('${business.id}', '${type}')">
                        <div class="business-header">
                            <div class="business-logo" style="background-image: url('${business.logo}')"></div>
                            <div class="business-info">
                                <h3>${business.name}</h3>
                                <p>${business.type}</p>
                            </div>
                        </div>
                        <div class="business-image" style="background-image: url('${business.image}')"></div>
                        <div class="business-content">
                            <div class="business-description">${business.description.substring(0, 100)}...</div>
                            <div class="business-promo">
                                <div class="promo-title">${business.promo}</div>
                                <div class="promo-details">${business.details}</div>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            // ===== USER FEED =====
            async populateUserFeed() {
                if (!this.state.isAuthenticated && !this.state.isGuest) return;
                
                const container = document.getElementById('userFeedContainer');
                container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                // If guest, show limited feed
                if (this.state.isGuest) {
                    this.populateGuestUserFeed();
                    return;
                }
                
                try {
                    // Try to fetch real users from Firebase
                    const snapshot = await window.db.collection('users')
                        .where('uid', '!=', this.state.currentUser.uid)
                        .limit(10)
                        .get();
                    
                    const users = [];
                    snapshot.forEach(doc => {
                        const userData = doc.data();
                        if (userData.userType !== 'business') { // Don't show business accounts in user feed
                            users.push({
                                id: doc.id,
                                name: userData.name || 'Anonymous',
                                age: userData.age || 25,
                                image: userData.photos?.[0] || userData.photo || 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop',
                                interests: userData.interests || ['Travel', 'Adventure'],
                                bio: userData.bio || 'Exploring Hoi An and meeting new people!',
                                isOnline: Math.random() > 0.5,
                                distance: `${Math.floor(Math.random() * 5) + 1} km`,
                                matchPercentage: Math.floor(Math.random() * 30) + 70,
                                category: userData.category || 'all'
                            });
                        }
                    });
                    
                    // If no users or very few, add demo users
                    if (users.length < 3) {
                        this.data.users.forEach(demoUser => {
                            if (!users.find(u => u.name === demoUser.name)) {
                                users.push(demoUser);
                            }
                        });
                    }
                    
                    // Populate feed
                    container.innerHTML = '';
                    users.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                    
                } catch (error) {
                    console.error('Error loading users:', error);
                    // Fallback to demo users
                    container.innerHTML = '';
                    this.data.users.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                }
            },
            
            populateGuestUserFeed() {
                const container = document.getElementById('userFeedContainer');
                container.innerHTML = '';
                
                // Show limited demo users for guests
                const demoUsers = this.data.users.slice(0, 3);
                demoUsers.forEach((user, index) => {
                    const feedItem = this.createGuestUserFeedItem(user, index);
                    container.appendChild(feedItem);
                });
                
                // Add sign up prompt
                const signupPrompt = document.createElement('div');
                signupPrompt.className = 'empty-state';
                signupPrompt.innerHTML = `
                    <div style="font-size: 48px;">üîí</div>
                    <h3>Want to see more?</h3>
                    <p>Sign up to browse all users and start connecting!</p>
                    <button class="auth-btn" onclick="CLASSIFIED.showRegister()">Sign Up Now</button>
                `;
                container.appendChild(signupPrompt);
            },
            
            createGuestUserFeedItem(user, index) {
                const feedItem = document.createElement('div');
                feedItem.className = 'user-feed-item';
                feedItem.style.animationDelay = `${index * 0.1}s`;
                feedItem.style.cursor = 'pointer';
                
                feedItem.addEventListener('click', () => {
                    this.showError('Please sign up to view profiles and connect with users');
                });
                
                feedItem.innerHTML = `
                    <div class="user-status-badges">
                        <div class="status-badge" style="background: rgba(255,215,0,0.2); color: #FFD700; border-color: rgba(255,215,0,0.3);">
                            üîí Guest Mode
                        </div>
                    </div>
                    <div class="user-image" style="background-image: url('${user.image}'); filter: blur(8px);">
                        <div class="user-image-overlay">
                            <div class="user-name">${user.name}, ${user.age}</div>
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-bio">${user.bio.substring(0, 50)}...</div>
                        <div class="user-interests">
                            ${user.interests.slice(0, 3).map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                        </div>
                        <div class="user-actions" style="justify-content: center;">
                            <button class="action-btn" style="background: linear-gradient(135deg, #FFD700, #FFA500);" onclick="event.stopPropagation(); CLASSIFIED.showRegister()">
                                Sign Up to Connect
                            </button>
                        </div>
                    </div>
                `;
                
                return feedItem;
            },
            
            createUserFeedItem(user, index) {
                const feedItem = document.createElement('div');
                feedItem.className = 'user-feed-item';
                feedItem.style.animationDelay = `${index * 0.1}s`;
                feedItem.style.cursor = 'pointer';
                
                feedItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-actions')) {
                        this.openUserProfile(user);
                    }
                });
                
                feedItem.innerHTML = `
                    <div class="user-status-badges">
                        ${user.isOnline ? '<div class="status-badge status-online">üü¢ Online</div>' : ''}
                        <div class="status-badge status-distance">üìç ${user.distance}</div>
                        <div class="status-badge status-match">üî• ${user.matchPercentage}% Match</div>
                    </div>
                    <div class="user-image" style="background-image: url('${user.image}')">
                        <div class="user-image-overlay">
                            <div class="user-name">${user.name}, ${user.age}</div>
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-bio">${user.bio}</div>
                        <div class="user-interests">
                            ${user.interests.map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                        </div>
                        <div class="user-actions">
                            <button class="action-btn pass-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('pass', '${user.name}')">‚úï Pass</button>
                            <button class="action-btn chat-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('like', '${user.name}')">üí¨ Chat</button>
                            <button class="action-btn super-btn" onclick="event.stopPropagation(); CLASSIFIED.handleUserAction('superlike', '${user.name}')">‚≠ê Super</button>
                        </div>
                    </div>
                `;
                
                return feedItem;
            },
            
            filterUsers(filter) {
                // Update active filter chip
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
                
                // Filter users
                let filteredUsers = this.data.users;
                if (filter === 'online') {
                    filteredUsers = this.data.users.filter(user => user.isOnline);
                } else if (filter === 'nearby') {
                    filteredUsers = this.data.users.filter(user => {
                        const distance = parseFloat(user.distance);
                        return distance < 2;
                    });
                } else if (filter === 'nomads') {
                    filteredUsers = this.data.users.filter(user => user.category === 'nomads');
                }
                
                // Re-populate feed
                const container = document.getElementById('userFeedContainer');
                container.innerHTML = '';
                
                if (filteredUsers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 48px;">üîç</div>
                            <h3>No users found</h3>
                            <p>Try adjusting your filters</p>
                        </div>
                    `;
                } else {
                    filteredUsers.forEach((user, index) => {
                        const feedItem = this.createUserFeedItem(user, index);
                        container.appendChild(feedItem);
                    });
                }
            },
            
            // ===== PROFILE VIEWING =====
            openUserProfile(user) {
                document.getElementById('userProfileView').classList.add('show');
                this.state.isUserProfileOpen = true;
                this.state.currentViewedUser = user;
                
                // Populate profile data
                document.getElementById('userProfileTitle').textContent = user.name;
                document.getElementById('userProfileHero').style.backgroundImage = `url('${user.image}')`;
                document.getElementById('userProfileName').textContent = user.name;
                document.getElementById('userProfileAge').textContent = `${user.age} years old`;
                document.getElementById('userProfileMatch').textContent = `${user.matchPercentage}% Match`;
                document.getElementById('userProfileBio').textContent = user.bio;
                document.getElementById('userProfileDistance').textContent = user.distance;
                document.getElementById('userProfileStatus').textContent = user.isOnline ? 'Online Now' : 'Offline';
                document.getElementById('userProfileCategory').textContent = user.category === 'nomads' ? 'Digital Nomad' : 'Traveler';
                
                // Update interests
                const interestsContainer = document.getElementById('userProfileInterests');
                interestsContainer.innerHTML = user.interests.map(interest => 
                    `<span class="interest-tag">${interest}</span>`
                ).join('');
            },
            
            closeUserProfile() {
                document.getElementById('userProfileView').classList.remove('show');
                this.state.isUserProfileOpen = false;
                this.state.currentViewedUser = null;
            },
            
            viewMyProfile() {
                // Check if guest
                if (this.state.isGuest) {
                    this.showError('Please sign up to create your profile');
                    setTimeout(() => {
                        this.showRegister();
                    }, 1500);
                    return;
                }
                
                this.closeProfileEditor();
                document.getElementById('myProfileView').classList.add('show');
                this.updateMyProfileView();
            },
            
            closeMyProfile() {
                document.getElementById('myProfileView').classList.remove('show');
            },
            
            updateMyProfileView() {
                const profile = this.state.userProfile;
                
                // Update profile view
                document.getElementById('myProfileName').textContent = profile.name || 'Your Name';
                document.getElementById('myProfileAge').textContent = profile.age ? `${profile.age} years old` : 'Add your age';
                document.getElementById('myProfileBio').textContent = profile.bio || 'Complete your profile to start connecting with amazing people in Hoi An!';
                
                // Update details
                document.getElementById('myProfileAgeDetail').textContent = profile.age || '-';
                document.getElementById('myProfileHeightDetail').textContent = profile.height || '-';
                document.getElementById('myProfileCareerDetail').textContent = profile.career || '-';
                document.getElementById('myProfileZodiacDetail').textContent = profile.zodiac || '-';
                document.getElementById('myProfileLookingForDetail').textContent = profile.lookingFor || '-';
                
                // Update interests
                const interestsContainer = document.getElementById('myProfileInterests');
                if (profile.interests && profile.interests.length > 0) {
                    interestsContainer.innerHTML = profile.interests.map(interest => 
                        `<span class="interest-tag">${interest}</span>`
                    ).join('');
                } else {
                    interestsContainer.innerHTML = '<span class="interest-tag">Add interests in profile editor</span>';
                }
                
                // Update hero image
                if (profile.photos && profile.photos.length > 0 && profile.photos[0]) {
                    document.getElementById('myProfileHero').style.backgroundImage = `url('${profile.photos[0]}')`;
                }
            },
            
            shareMyProfile() {
                const shareText = `Check out my profile on CLASSIFIED Hoi An! üåü`;
                if (navigator.share) {
                    navigator.share({
                        title: 'My CLASSIFIED Profile',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText + ' - ' + window.location.href);
                    this.showSuccess('Profile link copied to clipboard! üìã');
                }
            },
            
            // ===== BUSINESS PROFILES =====
            openBusinessProfile(businessId, type) {
                const businesses = type === 'restaurant' ? this.data.restaurants : this.data.activities;
                const business = businesses.find(b => b.id === businessId);
                
                if (!business) return;
                
                // Show profile
                document.getElementById('businessProfile').classList.add('show');
                this.state.isProfileOpen = true;
                this.state.currentBusiness = { business, type };
                
                // Populate data
                document.getElementById('profileHeaderTitle').textContent = business.name;
                document.getElementById('profileHero').style.backgroundImage = `url('${business.image}')`;
                document.getElementById('profileName').textContent = business.name;
                document.getElementById('profileType').textContent = business.type;
                document.getElementById('profilePromoTitle').textContent = business.promo;
                document.getElementById('profilePromoDetails').textContent = business.details;
                document.getElementById('profileDescription').textContent = business.description;
                document.getElementById('profileLocation').textContent = business.location;
                document.getElementById('profileHours').textContent = business.hours;
                document.getElementById('profilePrice').textContent = business.price;
                document.getElementById('profileContact').textContent = business.contact;
            },
            
            closeBusinessProfile() {
                document.getElementById('businessProfile').classList.remove('show');
                this.state.isProfileOpen = false;
                this.state.currentBusiness = null;
            },
            
            shareBusinessProfile() {
                if (this.state.currentBusiness) {
                    const business = this.state.currentBusiness.business;
                    const shareText = `Check out ${business.name} in Hoi An! ${business.promo}`;
                    if (navigator.share) {
                        navigator.share({
                            title: business.name,
                            text: shareText,
                            url: window.location.href
                        });
                    } else {
                        navigator.clipboard.writeText(shareText + ' - ' + window.location.href);
                        this.showSuccess('Business info copied to clipboard! üìã');
                    }
                }
            },
            
            getDirections() {
                if (this.state.currentBusiness) {
                    const business = this.state.currentBusiness.business;
                    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(business.location)}`;
                    window.open(mapsUrl, '_blank');
                }
            },
            
            // ===== MESSAGING =====
            populateMessaging() {
                const matchesContainer = document.getElementById('matchesScroll');
                const chatListContainer = document.getElementById('chatList');
                
                // Check if guest
                if (this.state.isGuest) {
                    matchesContainer.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.7;">Sign up to start matching!</div>';
                    chatListContainer.innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 48px;">üí¨</div>
                            <h3>No messages yet</h3>
                            <p>Sign up to start chatting with people in Hoi An!</p>
                            <button class="auth-btn" onclick="CLASSIFIED.showRegister()">Sign Up Now</button>
                        </div>
                    `;
                    return;
                }
                
                // Regular messaging for authenticated users
                // Matches
                matchesContainer.innerHTML = this.data.users.slice(0, 3).map(user => 
                    `<div class="match-avatar" style="background-image: url('${user.image}')" 
                         onclick="CLASSIFIED.openChatWithUser('${user.name}')"></div>`
                ).join('');
                
                // Chat list
                chatListContainer.innerHTML = this.data.chats.map(chat => 
                    `<div class="chat-item" onclick="CLASSIFIED.openChatWithUser('${chat.name}')">
                        <div class="chat-avatar" style="background-image: url('${chat.avatar}')"></div>
                        <div class="chat-info">
                            <div class="chat-name">${chat.name}</div>
                            <div class="chat-message">${chat.message}</div>
                        </div>
                        <div class="chat-time">${chat.time}</div>
                    </div>`
                ).join('');
            },
            
            openChatWithUser(userName) {
                const user = this.data.users.find(u => u.name === userName);
                
                if (user) {
                    this.state.currentChatUser = user;
                    this.openChat(user.name, user.image);
                }
            },
            
            openChat(name, avatar) {
                document.getElementById('individualChat').classList.add('show');
                this.state.isChatOpen = true;
                
                document.getElementById('chatName').textContent = name;
                document.getElementById('chatAvatar').style.backgroundImage = `url('${avatar}')`;
            },
            
            closeChat() {
                document.getElementById('individualChat').classList.remove('show');
                this.state.isChatOpen = false;
                this.state.currentChatUser = null;
            },
            
            openProfileFromChat() {
                if (this.state.currentChatUser) {
                    this.openUserProfile(this.state.currentChatUser);
                }
            },
            
            startChatWithViewedUser() {
                if (this.state.currentViewedUser) {
                    const user = this.state.currentViewedUser;
                    this.closeUserProfile();
                    setTimeout(() => {
                        this.openChatWithUser(user.name);
                    }, 300);
                }
            },
            
            sendMessage() {
                const input = document.getElementById('messageInput');
                const messages = document.getElementById('chatMessages');
                
                if (input.value.trim()) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message sent';
                    messageDiv.innerHTML = `<div class="message-bubble">${input.value}</div>`;
                    messages.appendChild(messageDiv);
                    messages.scrollTop = messages.scrollHeight;
                    input.value = '';
                }
            },
            
            // ===== USER ACTIONS =====
            handleUserAction(action, userName) {
                // Check if guest
                if (this.state.isGuest) {
                    this.showError('Please sign up to connect with users');
                    setTimeout(() => {
                        this.showRegister();
                    }, 1500);
                    return;
                }
                
                if (!userName && this.state.currentViewedUser) {
                    userName = this.state.currentViewedUser.name;
                }
                
                if (action === 'like' || action === 'superlike') {
                    if (this.state.isUserProfileOpen) {
                        this.closeUserProfile();
                    }
                    
                    // Simulate match for Jessica
                    if (userName === 'Jessica') {
                        setTimeout(() => this.showMatchPopup(), 500);
                    } else {
                        setTimeout(() => {
                            this.showSuccess(`You liked ${userName}! üíï They'll be notified when they're online.`);
                        }, 300);
                    }
                } else if (action === 'pass') {
                    if (this.state.isUserProfileOpen) {
                        this.closeUserProfile();
                    }
                }
            },
            
            showMatchPopup() {
                document.getElementById('matchPopup').classList.add('show');
            },
            
            startChatFromMatch() {
                document.getElementById('matchPopup').classList.remove('show');
                this.openChatWithUser('Jessica');
            },
            
            // ===== SETTINGS =====
            openSettings() {
                const settingsContent = document.querySelector('.settings-content');
                
                // Check if guest
                if (this.state.isGuest) {
                    settingsContent.innerHTML = `
                        <h3>Guest Mode</h3>
                        <div class="settings-options">
                            <button onclick="CLASSIFIED.showRegister(); CLASSIFIED.closeSettings();">
                                <span>üìù</span> Sign Up for Full Access
                            </button>
                            <button onclick="CLASSIFIED.showLogin(); CLASSIFIED.closeSettings();">
                                <span>üîë</span> Login to Existing Account
                            </button>
                            <button onclick="CLASSIFIED.showBusinessLogin(); CLASSIFIED.closeSettings();">
                                <span>üíº</span> Business Login
                            </button>
                        </div>
                    `;
                } else if (this.state.userType === 'business') {
                    // Business settings
                    settingsContent.innerHTML = `
                        <h3>Business Settings</h3>
                        <div class="settings-options">
                            <button onclick="CLASSIFIED.editBusinessProfile(); CLASSIFIED.closeSettings();">
                                <span>‚úèÔ∏è</span> Edit Business Profile
                            </button>
                            <button onclick="CLASSIFIED.managePromotions(); CLASSIFIED.closeSettings();">
                                <span>üéØ</span> Manage Promotions
                            </button>
                            <button onclick="CLASSIFIED.viewAnalytics(); CLASSIFIED.closeSettings();">
                                <span>üìä</span> View Analytics
                            </button>
                            <button class="logout-btn" onclick="CLASSIFIED.logout(); CLASSIFIED.closeSettings();">
                                <span>üö™</span> Logout
                            </button>
                        </div>
                    `;
                } else {
                    // Regular user settings (keep existing)
                    settingsContent.innerHTML = `
                        <h3>Settings</h3>
                        <div class="settings-options">
                            <button onclick="CLASSIFIED.openProfileEditor(); CLASSIFIED.closeSettings();">
                                <span>‚úèÔ∏è</span> Edit Profile
                            </button>
                            <button onclick="CLASSIFIED.viewMyProfile(); CLASSIFIED.closeSettings();">
                                <span>üë§</span> View My Profile
                            </button>
                            <button onclick="CLASSIFIED.openPrivacySettings(); CLASSIFIED.closeSettings();">
                                <span>üîí</span> Privacy Settings
                            </button>
                            <button onclick="CLASSIFIED.openNotificationSettings(); CLASSIFIED.closeSettings();">
                                <span>üîî</span> Notifications
                            </button>
                            <button class="logout-btn" onclick="CLASSIFIED.logout(); CLASSIFIED.closeSettings();">
                                <span>üö™</span> Logout
                            </button>
                        </div>
                    `;
                }
                
                document.getElementById('settingsMenu').classList.remove('hidden');
            },
            
            // Business-specific methods
            editBusinessProfile() {
                this.showSuccess('Business profile editor coming soon!');
            },
            
            managePromotions() {
                this.showSuccess('Promotion management coming soon!');
            },
            
            viewAnalytics() {
                this.showSuccess('Analytics dashboard coming soon!');
            },
            
            closeSettings() {
                document.getElementById('settingsMenu').classList.add('hidden');
            },
            
            openPrivacySettings() {
                this.showSuccess('Privacy settings coming soon!');
            },
            
            openNotificationSettings() {
                this.showSuccess('Notification settings coming soon!');
            },
            
            // ===== UTILITIES =====
            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },
            
            addImageErrorHandlers() {
                // Add error handlers for all images
                document.addEventListener('error', (e) => {
                    if (e.target.tagName === 'IMG' || 
                        (e.target.style && e.target.style.backgroundImage)) {
                        e.target.onerror = null; // Prevent infinite loop
                        if (e.target.tagName === 'IMG') {
                            e.target.src = 'https://via.placeholder.com/400x300?text=Image+Not+Found';
                        } else {
                            e.target.style.backgroundImage = 'url(https://via.placeholder.com/400x300?text=Image+Not+Found)';
                        }
                    }
                }, true);
            }
        };
        
        // Make CLASSIFIED globally available
        window.CLASSIFIED = CLASSIFIED;
        
        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); }
                to { transform: translate(-50%, 0); }
            }
            
            @keyframes slideUp {
                from { transform: translate(-50%, 0); }
                to { transform: translate(-50%, -100%); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            CLASSIFIED.init();
        });
    </script>
</body>
</html>
